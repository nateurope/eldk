<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title xmlns="http://www.w3.org/1999/xhtml">OProfile manual</title>
    <meta xmlns="http://www.w3.org/1999/xhtml" name="generator" content="DocBook XSL Stylesheets V1.49"/>
  </head>
  <body>
    <div xmlns="http://www.w3.org/1999/xhtml" class="book">
      <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
        <div xmlns="http://www.w3.org/1999/xhtml">
          <h1 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="oprofile-guide"/>OProfile manual</h1>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml">
          <h3 xmlns="http://www.w3.org/1999/xhtml" class="author">John Levon</h3>
          <div xmlns="http://www.w3.org/1999/xhtml" class="affiliation">
            <div xmlns="http://www.w3.org/1999/xhtml" class="address">
              <p>
                <tt xmlns="http://www.w3.org/1999/xhtml">&lt;<a xmlns="http://www.w3.org/1999/xhtml" href="mailto:levon@movementarian.org">levon@movementarian.org</a>&gt;</tt>
              </p>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml">
          <p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2000-2004 Victoria University of Manchester, John Levon and others</p>
        </div>
        <hr xmlns="http://www.w3.org/1999/xhtml"/>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
        <p xmlns="http://www.w3.org/1999/xhtml">
          <b>Table of Contents</b>
        </p>
        <dl>
          <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#introduction">Introduction</a></dt>
          <dd>
            <dl>
              <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#applications">Applications of OProfile</a></dt>
              <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#requirements">System requirements</a></dt>
              <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#resources">Internet resources</a></dt>
              <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#install">Installation</a></dt>
              <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#uninstall">Uninstalling OProfile</a></dt>
            </dl>
          </dd>
          <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#overview">Overview</a></dt>
          <dd>
            <dl>
              <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#getting-started">Getting started</a></dt>
              <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#tools-overview">Tools summary</a></dt>
            </dl>
          </dd>
          <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#controlling">Controlling the profiler</a></dt>
          <dd>
            <dl>
              <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#controlling-daemon">Using opcontrol</a></dt>
              <dd>
                <dl>
                  <dt>1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opcontrolexamples">Examples</a></dt>
                  <dd>
                    <dl>
                      <dt>1.1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesperfctr">Intel performance counter setup</a></dt>
                      <dt>1.1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesrtc">RTC mode</a></dt>
                      <dt>1.1.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesstartdaemon">Starting the daemon separately</a></dt>
                      <dt>1.1.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#exampleseparate">Separate profiles for libraries and the kernel</a></dt>
                      <dt>1.1.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplessessions">Profiling sessions</a></dt>
                    </dl>
                  </dd>
                  <dt>1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#eventspec">Specifying performance counter events</a></dt>
                </dl>
              </dd>
              <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#oprofile-gui">Using oprof_start</a></dt>
              <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#detailed-parameters">Configuration details</a></dt>
              <dd>
                <dl>
                  <dt>3.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#hardware-counters">Hardware performance counters</a></dt>
                  <dt>3.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#rtc">OProfile in RTC mode</a></dt>
                  <dt>3.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#timer">OProfile in timer interrupt mode</a></dt>
                  <dt>3.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#p4">Pentium 4 support</a></dt>
                  <dt>3.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#ia64">Intel Itanium 2 support</a></dt>
                  <dt>3.6. <a xmlns="http://www.w3.org/1999/xhtml" href="#ppc64">PowerPC64 support</a></dt>
                  <dt>3.7. <a xmlns="http://www.w3.org/1999/xhtml" href="#misuse">Dangerous counter settings</a></dt>
                </dl>
              </dd>
            </dl>
          </dd>
          <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#results">Obtaining results</a></dt>
          <dd>
            <dl>
              <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec">Profile specifications</a></dt>
              <dd>
                <dl>
                  <dt>1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec-examples">Examples</a></dt>
                  <dt>1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec-details">Profile specification parameters</a></dt>
                  <dt>1.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#id2816552">Locating and managing binary images</a></dt>
                  <dt>1.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#no-results">What to do when you don't get any results</a></dt>
                </dl>
              </dd>
              <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport">Image summaries and symbol summaries (opreport)</a></dt>
              <dd>
                <dl>
                  <dt>2.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-merging">Merging separate profiles</a></dt>
                  <dt>2.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-comparison">Side-by-side multiple results</a></dt>
                  <dt>2.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-callgraph">Callgraph output</a></dt>
                  <dt>2.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-diff">Differential profiles with opreport</a></dt>
                  <dt>2.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-anon">Anonymous executable mappings</a></dt>
                  <dt>2.6. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-options">Options for opreport</a></dt>
                </dl>
              </dd>
              <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate">Outputting annotated source (opannotate)</a></dt>
              <dd>
                <dl>
                  <dt>3.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate-finding-source">Locating source files</a></dt>
                  <dt>3.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate-details">Usage of opannotate</a></dt>
                </dl>
              </dd>
              <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#opgprof">gprof-compatible output (opgprof)</a></dt>
              <dd>
                <dl>
                  <dt>4.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opgprof-details">Usage of opgprof</a></dt>
                </dl>
              </dd>
              <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#oparchive">Archiving measurements (oparchive)</a></dt>
              <dd>
                <dl>
                  <dt>5.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#oparchive-details">Usage of oparchive</a></dt>
                </dl>
              </dd>
              <dt>6. <a xmlns="http://www.w3.org/1999/xhtml" href="#opimport">Converting sample database files (opimport)</a></dt>
              <dd>
                <dl>
                  <dt>6.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opimport-details">Usage of opimport</a></dt>
                </dl>
              </dd>
            </dl>
          </dd>
          <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting">Interpreting profiling results</a></dt>
          <dd>
            <dl>
              <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#irq-latency">Profiling interrupt latency</a></dt>
              <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#kernel-profiling">Kernel profiling</a></dt>
              <dd>
                <dl>
                  <dt>2.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#irq-masking">Interrupt masking</a></dt>
                  <dt>2.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#idle">Idle time</a></dt>
                  <dt>2.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#kernel-modules">Profiling kernel modules</a></dt>
                </dl>
              </dd>
              <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting-callgraph">Interpreting call-graph profiles</a></dt>
              <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#debug-info">Inaccuracies in annotated source</a></dt>
              <dd>
                <dl>
                  <dt>4.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#effect-of-optimizations">Side effects of optimizations</a></dt>
                  <dt>4.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#prologues">Prologues and epilogues</a></dt>
                  <dt>4.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#inlined-function">Inlined functions</a></dt>
                  <dt>4.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#wrong-linenr-info">Inaccuracy in line number information</a></dt>
                </dl>
              </dd>
              <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#symbol-without-debug-info">Assembly functions</a></dt>
              <dt>6. <a xmlns="http://www.w3.org/1999/xhtml" href="#hidden-cost">Other discrepancies</a></dt>
            </dl>
          </dd>
          <dt>6. <a xmlns="http://www.w3.org/1999/xhtml" href="#ack">Acknowledgments</a></dt>
        </dl>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="introduction"/>Chapter 1. Introduction</h2>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
          <p xmlns="http://www.w3.org/1999/xhtml">
            <b>Table of Contents</b>
          </p>
          <dl>
            <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#applications">Applications of OProfile</a></dt>
            <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#requirements">System requirements</a></dt>
            <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#resources">Internet resources</a></dt>
            <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#install">Installation</a></dt>
            <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#uninstall">Uninstalling OProfile</a></dt>
          </dl>
        </div>
        <p xmlns="http://www.w3.org/1999/xhtml">
This manual applies to OProfile version 0.9.2.
OProfile is a profiling system for Linux 2.2/2.4/2.6 systems on a number of architectures. It is capable of profiling
all parts of a running system, from the kernel (including modules and interrupt handlers) to shared libraries
to binaries. It runs transparently in the background collecting information at a low overhead. These
features make it ideal for profiling entire systems to determine bottle necks in real-world systems.
</p>
        <p xmlns="http://www.w3.org/1999/xhtml">
Many CPUs provide &quot;performance counters&quot;, hardware registers that can count &quot;events&quot;; for example,
cache misses, or CPU cycles. OProfile provides profiles of code based on the number of these occurring events:
repeatedly, every time a certain (configurable) number of events has occurred, the PC value is recorded.
This information is aggregated into profiles for each binary image.</p>
        <p xmlns="http://www.w3.org/1999/xhtml">
Some hardware setups do not allow OProfile to use performance counters: in these cases, no
events are available, and OProfile operates in timer/RTC mode, as described in later chapters.
</p>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="applications"/>1. Applications of OProfile</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
OProfile is useful in a number of situations. You might want to use OProfile when you :
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist">
            <ul type="disc">
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need low overhead</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">cannot use highly intrusive profiling methods</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need to profile interrupt handlers</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need to profile an application and its shared libraries</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need to capture the performance behaviour of entire system</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">want to examine hardware effects such as cache misses</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">want detailed source annotation</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">want instruction-level profiles</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">want call-graph profiles</p>
              </li>
            </ul>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
OProfile is not a panacea. OProfile might not be a complete solution when you :
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist">
            <ul type="disc">
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">require call graph profiles on platforms other than 2.6/x86</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">don't have root permissions</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">require 100% instruction-accurate profiles</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need function call counts or an interstitial profiling API</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">cannot tolerate any disturbance to the system whatsoever</p>
              </li>
              <li xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">need to profile interpreted or dynamically compiled code such as Java or Python</p>
              </li>
            </ul>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="requirements"/>2. System requirements</h2>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Linux kernel 2.2/2.4/2.6</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			OProfile uses a kernel module that can be compiled for
			2.2.11 or later and 2.4. 2.4.10 or above is required if you use the 
			boot-time kernel option <tt xmlns="http://www.w3.org/1999/xhtml">nosmp</tt>.  2.6 kernels are supported with the in-kernel
			OProfile driver. Note that only 32-bit x86 and IA64 are supported on 2.2/2.4 kernels.
			</p>
                <p xmlns="http://www.w3.org/1999/xhtml">
			2.6 kernels are strongly recommended. Under 2.4, OProfile may cause system crashes if power
			management is used, or the BIOS does not correctly deal with local APICs.
			</p>
                <p xmlns="http://www.w3.org/1999/xhtml">
			PPC64 processors (Power4/Power5/PPC970) require a recent (&gt; 2.6.5) kernel with the line 
			<tt xmlns="http://www.w3.org/1999/xhtml">#define PV_970</tt> present in <tt xmlns="http://www.w3.org/1999/xhtml">include/asm-ppc64/processor.h</tt>.

		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">modutils 2.4.6 or above</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			You should have installed modutils 2.4.6 or higher (in fact earlier versions work well in almost all
			cases).
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Supported architecture</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			For Intel IA32, a CPU with either a P6 generation or Pentium 4 core is
			required. In marketing terms this translates to anything
			between an Intel Pentium Pro (not Pentium Classics) and
			a Pentium 4 / Xeon, including all Celerons.  The AMD
			Athlon, and Duron CPUs are also supported.  Other IA32
			CPU types only support the RTC mode of OProfile; please
			see later in this manual for details.  Hyper-threaded Pentium IVs
			are not supported in 2.4. For 2.4 kernels, the Intel
			IA-64 CPUs are also supported. For 2.6 kernels, there is additionally
			support for Alpha processors, MIPS, ARM, x86-64, sparc64, ppc64, and,
			in timer mode, PA-RISC and s390.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Uniprocessor or SMP</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			SMP machines are fully supported.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Required libraries</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			These libraries are required : <tt xmlns="http://www.w3.org/1999/xhtml">popt</tt>, <tt xmlns="http://www.w3.org/1999/xhtml">bfd</tt>,
			<tt xmlns="http://www.w3.org/1999/xhtml">liberty</tt> (debian users: libiberty is provided in binutils-dev package), <tt xmlns="http://www.w3.org/1999/xhtml">dl</tt>,
			plus the standard C++ libraries.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">OProfile GUI</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			The use of the GUI to start the profiler requires the <tt xmlns="http://www.w3.org/1999/xhtml">Qt 2</tt> library. <tt xmlns="http://www.w3.org/1999/xhtml">Qt 3</tt> should
			also work.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">ELF</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Probably not too strenuous a requirement, but older A.OUT binaries/libraries are not supported.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">K&amp;R coding style</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			OK, so it's not really a requirement, but I wish it was...
		</p>
              </dd>
            </dl>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="resources"/>3. Internet resources</h2>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Web page</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			There is a web page (which you may be reading now) at
			<a xmlns="http://www.w3.org/1999/xhtml" href="http://oprofile.sf.net/">http://oprofile.sf.net/</a>.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Download</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			You can download a source tarball or get anonymous CVS at the sourceforge page,
			<a xmlns="http://www.w3.org/1999/xhtml" href="http://sf.net/projects/oprofile/">http://sf.net/projects/oprofile/</a>.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Mailing list</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			There is a low-traffic OProfile-specific mailing list, details at
			<a xmlns="http://www.w3.org/1999/xhtml" href="http://sf.net/mail/?group_id=16191">http://sf.net/mail/?group_id=16191</a>.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">Bug tracker</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			There is a bug tracker for OProfile at SourceForge,
			<a xmlns="http://www.w3.org/1999/xhtml" href="http://sf.net/tracker/?group_id=16191&amp;#38;atid=116191">http://sf.net/tracker/?group_id=16191&amp;atid=116191</a>.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">IRC channel</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Several OProfile developers and users sometimes hang out on channel <b xmlns="http://www.w3.org/1999/xhtml">#oprofile</b>
			on the <a xmlns="http://www.w3.org/1999/xhtml" href="http://freenode.info">freenode</a> network. 
		</p>
              </dd>
            </dl>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="install"/>4. Installation</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
First you need to build OProfile and install it. <b xmlns="http://www.w3.org/1999/xhtml">./configure</b>, <b xmlns="http://www.w3.org/1999/xhtml">make</b>, <b xmlns="http://www.w3.org/1999/xhtml">make install</b>
is often all you need, but note these arguments to <b xmlns="http://www.w3.org/1999/xhtml">./configure</b> :
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--with-linux</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Use this option to specify the location of the kernel source tree you wish
			to compile against. The kernel module is built against this source and
			will only work with a running kernel built from the same source with
			exact same options, so it is important you specify this option if you need
			to.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--with-kernel-support</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Use this option with 2.6 and above kernels to indicate the 
	    		kernel provides the OProfile device driver.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--with-qt-dir/includes/libraries</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Specify the location of Qt headers and libraries. It defaults to searching in
			<tt xmlns="http://www.w3.org/1999/xhtml">$QTDIR</tt> if these are not specified.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <a xmlns="http://www.w3.org/1999/xhtml" id="disable-werror"/>
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--disable-werror</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Development versions of OProfile build by
			default with <tt xmlns="http://www.w3.org/1999/xhtml">-Werror</tt>. This option turns
			<tt xmlns="http://www.w3.org/1999/xhtml">-Werror</tt> off.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <a xmlns="http://www.w3.org/1999/xhtml" id="disable-optimization"/>
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--disable-optimization</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
			Disable the <tt xmlns="http://www.w3.org/1999/xhtml">-O2</tt> compiler flag
			(useful if you discover an OProfile bug and want to give a useful
			back-trace etc.)
		</p>
              </dd>
            </dl>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
You'll need to have a configured kernel source for the current kernel
to build the module for 2.4 kernels.  Since all distributions provide different kernels it's unlikely the running kernel match the configured source
you installed. The safest way is to recompile your own kernel, run it and compile oprofile. It is also recommended that if you have a
uniprocessor machine, you enable the local APIC / IO_APIC support for
your kernel (this is automatically enabled for SMP kernels). With many BIOS, kernel &gt;= 2.6.9 and UP kernel it's not sufficient to enable the local APIC you must also turn it on explicitely at boot time by providing &quot;lapic&quot; option to the kernel. On
machines with power management, such as laptops, the power management
must be turned off when using OProfile with 2.4 kernels. The power management software
in the BIOS cannot handle the non-maskable interrupts (NMIs) used by
OProfile for data collection. If you use the NMI watchdog, be aware that
the watchdog is disabled when profiling starts, and not re-enabled until the
OProfile module is removed (or, in 2.6, when OProfile is not running). If you compile OProfile for
a 2.2 kernel you must be root to compile the module. If you are using
2.6 kernels or higher, you do not need kernel source, as long as the
OProfile driver is enabled; additionally, you should not need to disable
power management.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Please note that you must save or have available the <tt xmlns="http://www.w3.org/1999/xhtml">vmlinux</tt> file
generated during a kernel compile, as OProfile needs it (you can use
<tt xmlns="http://www.w3.org/1999/xhtml">--no-vmlinux</tt>, but this will prevent kernel profiling).
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="uninstall"/>5. Uninstalling OProfile</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
You must have the source tree available to uninstall OProfile; a <b xmlns="http://www.w3.org/1999/xhtml">make uninstall</b> will
remove all installed files except your configuration file in the directory <tt xmlns="http://www.w3.org/1999/xhtml">~/.oprofile</tt>.
</p>
        </div>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="overview"/>Chapter 2. Overview</h2>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
          <p xmlns="http://www.w3.org/1999/xhtml">
            <b>Table of Contents</b>
          </p>
          <dl>
            <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#getting-started">Getting started</a></dt>
            <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#tools-overview">Tools summary</a></dt>
          </dl>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="getting-started"/>1. Getting started</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
Before you can use OProfile, you must set it up. The minimum setup required for this
is to tell OProfile where the <tt xmlns="http://www.w3.org/1999/xhtml">vmlinux</tt> file corresponding to the
running kernel is, for example :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opcontrol --vmlinux=/boot/vmlinux-`uname -r`</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
If you don't want to profile the kernel itself,
you can tell OProfile you don't have a <tt xmlns="http://www.w3.org/1999/xhtml">vmlinux</tt> file :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opcontrol --no-vmlinux</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Now we are ready to start the daemon (<b xmlns="http://www.w3.org/1999/xhtml">oprofiled</b>) which collects
the profile data :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opcontrol --start</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
When I want to stop profiling, I can do so with :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opcontrol --shutdown</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Note that unlike <b xmlns="http://www.w3.org/1999/xhtml">gprof</b>, no instrumentation (<tt xmlns="http://www.w3.org/1999/xhtml">-pg</tt>
and <tt xmlns="http://www.w3.org/1999/xhtml">-a</tt> options to <b xmlns="http://www.w3.org/1999/xhtml">gcc</b>)
is necessary.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Periodically (or on <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --shutdown</b> or <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --dump</b>)
the profile data is written out into the <tt xmlns="http://www.w3.org/1999/xhtml">/var/lib/oprofile/samples</tt> directory.
These profile files cover shared libraries, applications, the kernel (vmlinux), and kernel modules.
You can clear the profile data (at any time) with <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --reset</b>.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
You can get summaries of this data in a number of ways at any time. To get a summary of
data across the entire system for all of these profiles, you can do :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opreport</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Or to get a more detailed summary, for a particular image, you can do something like :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">opreport -l /boot/vmlinux-`uname -r`</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
There are also a number of other ways of presenting the data, as described later in this manual.
Note that OProfile will choose a default profiling setup for you. However, there are a number
of options you can pass to <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b> if you need to change something,
also detailed later.
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="tools-overview"/>2. Tools summary</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
This section gives a brief description of the available OProfile utilities and their purpose.
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">ophelp</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This utility lists the available events and short descriptions.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">opcontrol</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Used for controlling the OProfile data collection, discussed in <a xmlns="http://www.w3.org/1999/xhtml" href="#controlling" title="Chapter 3. Controlling the profiler">Chapter 3</a>.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">opreport</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This is the main tool for retrieving useful profile data, described in
		<a xmlns="http://www.w3.org/1999/xhtml" href="#opreport" title="2. Image summaries and symbol summaries (opreport)">Section 2</a>.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">opannotate</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This utility can be used to produce annotated source, assembly or mixed source/assembly.
		Source level annotation is available only if the application was compiled with 
		debugging symbols. See <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate" title="3. Outputting annotated source (opannotate)">Section 3</a>.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">opgprof</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This utility can output gprof-style data files for a binary, for use with
		<b xmlns="http://www.w3.org/1999/xhtml">gprof -p</b>. See <a xmlns="http://www.w3.org/1999/xhtml" href="#opgprof" title="4. gprof-compatible output (opgprof)">Section 4</a>.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">oparchive</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This utility can be used to collect executables, debuginfo,
		and sample files and copy the files into an archive.
		The archive is self-contained and can be moved to another
		machine for further analysis.
		See <a xmlns="http://www.w3.org/1999/xhtml" href="#oparchive" title="5. Archiving measurements (oparchive)">Section 5</a>.
	</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">opimport</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		This utility converts sample database files from a foreign binary format (abi) to
		the native format. This is useful only when moving sample files between hosts,
		for analysis on platforms other than the one used for collection.
		See <a xmlns="http://www.w3.org/1999/xhtml" href="#opimport" title="6. Converting sample database files (opimport)">Section 6</a>.
	</p>
              </dd>
            </dl>
          </div>
        </div>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="controlling"/>Chapter 3. Controlling the profiler</h2>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
          <p xmlns="http://www.w3.org/1999/xhtml">
            <b>Table of Contents</b>
          </p>
          <dl>
            <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#controlling-daemon">Using opcontrol</a></dt>
            <dd>
              <dl>
                <dt>1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opcontrolexamples">Examples</a></dt>
                <dd>
                  <dl>
                    <dt>1.1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesperfctr">Intel performance counter setup</a></dt>
                    <dt>1.1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesrtc">RTC mode</a></dt>
                    <dt>1.1.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplesstartdaemon">Starting the daemon separately</a></dt>
                    <dt>1.1.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#exampleseparate">Separate profiles for libraries and the kernel</a></dt>
                    <dt>1.1.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#examplessessions">Profiling sessions</a></dt>
                  </dl>
                </dd>
                <dt>1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#eventspec">Specifying performance counter events</a></dt>
              </dl>
            </dd>
            <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#oprofile-gui">Using oprof_start</a></dt>
            <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#detailed-parameters">Configuration details</a></dt>
            <dd>
              <dl>
                <dt>3.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#hardware-counters">Hardware performance counters</a></dt>
                <dt>3.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#rtc">OProfile in RTC mode</a></dt>
                <dt>3.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#timer">OProfile in timer interrupt mode</a></dt>
                <dt>3.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#p4">Pentium 4 support</a></dt>
                <dt>3.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#ia64">Intel Itanium 2 support</a></dt>
                <dt>3.6. <a xmlns="http://www.w3.org/1999/xhtml" href="#ppc64">PowerPC64 support</a></dt>
                <dt>3.7. <a xmlns="http://www.w3.org/1999/xhtml" href="#misuse">Dangerous counter settings</a></dt>
              </dl>
            </dd>
          </dl>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="controlling-daemon"/>1. Using <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b></h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
In this section we describe the configuration and control of the profiling system
with opcontrol in more depth.
The <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b> script has a default setup, but you
can alter this with the options given below. In particular,
if your hardware supports performance counters, you can configure them.
There are a number of counters (for example, counter 0 and counter 1
on the Pentium III). Each of these counters can be programmed with
an event to count, such as cache misses or MMX operations. The event
chosen for each counter is reflected in the profile data collected
by OProfile: functions and binaries at the top of the profiles reflect
that most of the chosen events happened within that code.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Additionally, each counter has a &quot;count&quot; value: this corresponds to how
detailed the profile is. The lower the value, the more frequently profile
samples are taken. A counter can choose to sample only kernel code, user-space code,
or both (both is the default). Finally, some events have a &quot;unit mask&quot;
- this is a value that further restricts the types of event that are counted. 
The event types and unit masks for your CPU are listed by <b xmlns="http://www.w3.org/1999/xhtml">opcontrol
--list-events</b>.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
The <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b> script provides the following actions :
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--init</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Loads the OProfile module if required and makes the OProfile driver
		interface available.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--setup</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Followed by list arguments for profiling set up. List of arguments
		    saved in <tt xmlns="http://www.w3.org/1999/xhtml">/root/.oprofile/daemonrc</tt>.
		    Giving this option is not necessary; you can just directly pass one
		    of the setup options, e.g. <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --no-vmlinux</b>.
		  </p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--status</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Show configuration information.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--start-daemon</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Start the oprofile daemon without starting actual profiling. The profiling
		can then be started using <tt xmlns="http://www.w3.org/1999/xhtml">--start</tt>. This is useful for avoiding
		measuring the cost of daemon startup, as <tt xmlns="http://www.w3.org/1999/xhtml">--start</tt> is a simple
		write to a file in oprofilefs. Not available in 2.2/2.4 kernels.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--start</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Start data collection with either arguments provided by <tt xmlns="http://www.w3.org/1999/xhtml">--setup</tt>
		or information saved in <tt xmlns="http://www.w3.org/1999/xhtml">/root/.oprofile/daemonrc</tt>. Specifying
		the addition <tt xmlns="http://www.w3.org/1999/xhtml">--verbose</tt> makes the daemon generate lots of debug data
		whilst it is running.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--dump</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Force a flush of the collected profiling data to the daemon.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--stop</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Stop data collection (this separate step is not possible with 2.2 or 2.4 kernels).
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--shutdown</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Stop data collection and kill the daemon.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--reset</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Clears out data from current session, but leaves saved sessions.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--save=</tt>session_name</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Save data from current session to session_name.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--deinit</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
                Shuts down daemon. Unload the OProfile module and oprofilefs.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--list-events</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    List event types and unit masks.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--help</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		    Generate usage messages.
		</p>
              </dd>
            </dl>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
There are a number of possible settings, of which, only
<tt xmlns="http://www.w3.org/1999/xhtml">--vmlinux</tt> (or <tt xmlns="http://www.w3.org/1999/xhtml">--no-vmlinux</tt>)
is required. These settings are stored in <tt xmlns="http://www.w3.org/1999/xhtml">~/.oprofile/daemonrc</tt>.
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
            <dl>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--buffer-size=</tt>num</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Number of samples in kernel buffer. When using a 2.6 kernel
		buffer watershed need to be tweaked when changing this value.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--buffer-watershed=</tt>num</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Set kernel buffer watershed to num samples (2.6 only). When it'll remain only
		buffer-size - buffer-watershed free entry in the kernel buffer data will be
		flushed to daemon, most usefull value are in the range [0.25 - 0.5] * buffer-size.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--cpu-buffer-size=</tt>num</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Number of samples in kernel per-cpu buffer (2.6 only). If you
		profile at high rate it can help to increase this if the log
		file show excessive count of sample lost cpu buffer overflow. 
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--event=</tt>[eventspec]</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Use the given performance counter event to profile.
		See <a xmlns="http://www.w3.org/1999/xhtml" href="#eventspec" title="1.2. Specifying performance counter events">Section 1.2</a> below.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--separate=</tt>[none,lib,kernel,thread,cpu,all]</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		By default, every profile is stored in a single file. Thus, for example,
		samples in the C library are all accredited to the <tt xmlns="http://www.w3.org/1999/xhtml">/lib/libc.o</tt>
		profile. However, you choose to create separate sample files by specifying
		one of the below options.
		</p>
                <div xmlns="http://www.w3.org/1999/xhtml" class="informaltable">
                  <table xmlns="http://www.w3.org/1999/xhtml" border="1">
                    <colgroup xmlns="http://www.w3.org/1999/xhtml">
                      <col xmlns="http://www.w3.org/1999/xhtml"/>
                      <col xmlns="http://www.w3.org/1999/xhtml"/>
                    </colgroup>
                    <tbody xmlns="http://www.w3.org/1999/xhtml">
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">none</tt>
                        </td>
                        <td>No profile separation (default)</td>
                      </tr>
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">lib</tt>
                        </td>
                        <td>Create per-application profiles for libraries</td>
                      </tr>
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">kernel</tt>
                        </td>
                        <td>Create per-application profiles for the kernel and kernel modules</td>
                      </tr>
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">thread</tt>
                        </td>
                        <td>Create profiles for each thread and each task</td>
                      </tr>
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">cpu</tt>
                        </td>
                        <td>Create profiles for each CPU</td>
                      </tr>
                      <tr xmlns="http://www.w3.org/1999/xhtml">
                        <td>
                          <tt xmlns="http://www.w3.org/1999/xhtml">all</tt>
                        </td>
                        <td>All of the above options</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <p xmlns="http://www.w3.org/1999/xhtml">
		Note  that <tt xmlns="http://www.w3.org/1999/xhtml">--separate=kernel</tt> also turns on <tt xmlns="http://www.w3.org/1999/xhtml">--separate=lib</tt>.
		
		When using <tt xmlns="http://www.w3.org/1999/xhtml">--separate=kernel</tt>, samples in hardware interrupts, soft-irqs, or other
		asynchronous kernel contexts are credited to the task currently running. This means you will see
		seemingly nonsense profiles such as <tt xmlns="http://www.w3.org/1999/xhtml">/bin/bash</tt> showing samples for the PPP modules,
		etc.
		</p>
                <p xmlns="http://www.w3.org/1999/xhtml">
		On 2.2/2.4 only kernel threads already started when profiling begins are correctly profiled;
		newly started kernel thread samples are credited to the vmlinux (kernel) profile.
		</p>
                <p xmlns="http://www.w3.org/1999/xhtml">
		Using <tt xmlns="http://www.w3.org/1999/xhtml">--separate=thread</tt> creates a lot
		of sample files if you leave OProfile running for a while; it's most
		useful when used for short sessions, or when using image filtering.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--callgraph=</tt>#depth</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Enable call-graph sample collection with a maximum depth. Use 0 to disable
		callgraph profiling.  NOTE: Callgraph support is available on a limited
		number of platforms at this time; for example:
		<p xmlns="http://www.w3.org/1999/xhtml">
		<div xmlns="http://www.w3.org/1999/xhtml" class="itemizedlist"><ul type="disc"><li xmlns="http://www.w3.org/1999/xhtml"><p xmlns="http://www.w3.org/1999/xhtml">x86 with recent 2.6 kernel</p></li><li xmlns="http://www.w3.org/1999/xhtml"><p xmlns="http://www.w3.org/1999/xhtml">ARM with recent 2.6 kernel</p></li><li xmlns="http://www.w3.org/1999/xhtml"><p xmlns="http://www.w3.org/1999/xhtml">PowerPC with 2.6.17 kernel</p></li></ul></div>
		</p>
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--image=</tt>image,[images]|&quot;all&quot;</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Image filtering. If you specify one or more absolute
		paths to binaries, OProfile will only produce profile results for those
		binary images. This is useful for restricting the sometimes voluminous
		output you may get otherwise, especially with
		<tt xmlns="http://www.w3.org/1999/xhtml">--separate=thread</tt>. Note that if you are using
		<tt xmlns="http://www.w3.org/1999/xhtml">--separate=lib</tt> or
		<tt xmlns="http://www.w3.org/1999/xhtml">--separate=kernel</tt>, then if you specification an
		application binary, the shared libraries and kernel code
		<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">are</i></span> included. Specify the value
		&quot;all&quot; to profile everything (the default).
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term"><tt xmlns="http://www.w3.org/1999/xhtml">--vmlinux=</tt>file</span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		vmlinux kernel image.
		</p>
              </dd>
              <dt xmlns="http://www.w3.org/1999/xhtml">
                <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                  <tt xmlns="http://www.w3.org/1999/xhtml">--no-vmlinux</tt>
                </span>
              </dt>
              <dd xmlns="http://www.w3.org/1999/xhtml">
                <p xmlns="http://www.w3.org/1999/xhtml">
		Use this when you don't have a kernel vmlinux file, and you don't want
		to profile the kernel. This still counts the total number of kernel samples,
		but can't give symbol-based results for the kernel or any modules.
		</p>
              </dd>
            </dl>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opcontrolexamples"/>1.1. Examples</h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect3">
              <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
                <div xmlns="http://www.w3.org/1999/xhtml">
                  <h4 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="examplesperfctr"/>1.1.1. Intel performance counter setup</h4>
                </div>
              </div>
              <p xmlns="http://www.w3.org/1999/xhtml">
Here, we have a Pentium III running at 800MHz, and we want to look at where data memory
references are happening most, and also get results for CPU time.
</p>
              <table border="0" style="background: #E0E0E0;" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
# opcontrol --event=CPU_CLK_UNHALTED:400000 --event=DATA_MEM_REFS:10000
# opcontrol --vmlinux=/boot/2.6.0/vmlinux
# opcontrol --start
</pre>
                  </td>
                </tr>
              </table>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect3">
              <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
                <div xmlns="http://www.w3.org/1999/xhtml">
                  <h4 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="examplesrtc"/>1.1.2. RTC mode</h4>
                </div>
              </div>
              <p xmlns="http://www.w3.org/1999/xhtml">
Here, we have an Intel laptop without support for performance counters, running on 2.4 kernels.
</p>
              <table border="0" style="background: #E0E0E0;" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
# ophelp -r
CPU with RTC device
# opcontrol --vmlinux=/boot/2.4.13/vmlinux --event=RTC_INTERRUPTS:1024
# opcontrol --start
</pre>
                  </td>
                </tr>
              </table>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect3">
              <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
                <div xmlns="http://www.w3.org/1999/xhtml">
                  <h4 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="examplesstartdaemon"/>1.1.3. Starting the daemon separately</h4>
                </div>
              </div>
              <p xmlns="http://www.w3.org/1999/xhtml">
If we're running 2.6 kernels, we can use <tt xmlns="http://www.w3.org/1999/xhtml">--start-daemon</tt> to avoid
the profiler startup affecting results.
</p>
              <table border="0" style="background: #E0E0E0;" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
# opcontrol --vmlinux=/boot/2.6.0/vmlinux
# opcontrol --start-daemon
# my_favourite_benchmark --init
# opcontrol --start ; my_favourite_benchmark --run ; opcontrol --stop
</pre>
                  </td>
                </tr>
              </table>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect3">
              <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
                <div xmlns="http://www.w3.org/1999/xhtml">
                  <h4 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="exampleseparate"/>1.1.4. Separate profiles for libraries and the kernel</h4>
                </div>
              </div>
              <p xmlns="http://www.w3.org/1999/xhtml">
Here, we want to see a profile of the OProfile daemon itself, including when
it was running inside the kernel driver, and its use of shared libraries.
</p>
              <table border="0" style="background: #E0E0E0;" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
# opcontrol --separate=kernel --vmlinux=/boot/2.6.0/vmlinux
# opcontrol --start
# my_favourite_stress_test --run
# opreport -l -p /lib/modules/2.6.0/kernel /usr/local/bin/oprofiled
</pre>
                  </td>
                </tr>
              </table>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect3">
              <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
                <div xmlns="http://www.w3.org/1999/xhtml">
                  <h4 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="examplessessions"/>1.1.5. Profiling sessions</h4>
                </div>
              </div>
              <p xmlns="http://www.w3.org/1999/xhtml">
It can often be useful to split up profiling data into several different
time periods. For example, you may want to collect data on an application's
startup separately from the normal runtime data. You can use the simple
command <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --save</b> to do this. For example :
</p>
              <table border="0" style="background: #E0E0E0;" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
# opcontrol --save=blah
</pre>
                  </td>
                </tr>
              </table>
              <p xmlns="http://www.w3.org/1999/xhtml">
will create a sub-directory in <tt xmlns="http://www.w3.org/1999/xhtml">/var/lib/oprofile/samples</tt> containing the samples
up to that point (the current session's sample files are moved into this
directory). You can then pass this session name as a parameter to the post-profiling
analysis tools, to only get data up to the point you named the
session. If you do not want to save a session, you can do
<b xmlns="http://www.w3.org/1999/xhtml">rm -rf /var/lib/oprofile/samples/sessionname</b> or, for the
current session, <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --reset</b>.
</p>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="eventspec"/>1.2. Specifying performance counter events</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The <tt xmlns="http://www.w3.org/1999/xhtml">--event</tt> option to <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b>
takes a specification that indicates how the details of each
hardware performance counter should be setup. If you want to
revert to OProfile's default setting (<tt xmlns="http://www.w3.org/1999/xhtml">--event</tt>
is strictly optional), use <tt xmlns="http://www.w3.org/1999/xhtml">--event=default</tt>.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
You can pass multiple event specifications. OProfile will allocate
hardware counters as necessary. Note that some combinations are not
allowed by the CPU; running <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --list-events</b> gives the details
of each event. The event specification is a colon-separated string
of the form <tt xmlns="http://www.w3.org/1999/xhtml"><span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">name</i></span>:<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">count</i></span>:<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">unitmask</i></span>:<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">kernel</i></span>:<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">user</i></span></tt> as described in this table:
<div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p xmlns="http://www.w3.org/1999/xhtml">
For the PowerPC platforms, all events specified must be in the same group; i.e., the group number
appended to the event name (e.g. <tt xmlns="http://www.w3.org/1999/xhtml">&lt;<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">some-event-name</i></span>&gt;_GRP9</tt>) must be the same.
</p></div>
</p>
            <div xmlns="http://www.w3.org/1999/xhtml" class="informaltable">
              <table xmlns="http://www.w3.org/1999/xhtml" border="1">
                <colgroup xmlns="http://www.w3.org/1999/xhtml">
                  <col xmlns="http://www.w3.org/1999/xhtml"/>
                  <col xmlns="http://www.w3.org/1999/xhtml"/>
                </colgroup>
                <tbody xmlns="http://www.w3.org/1999/xhtml">
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>
                      <tt xmlns="http://www.w3.org/1999/xhtml">name</tt>
                    </td>
                    <td>The symbolic event name, e.g. <tt xmlns="http://www.w3.org/1999/xhtml">CPU_CLK_UNHALTED</tt></td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>
                      <tt xmlns="http://www.w3.org/1999/xhtml">count</tt>
                    </td>
                    <td>The counter reset value, e.g. 100000</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>
                      <tt xmlns="http://www.w3.org/1999/xhtml">unitmask</tt>
                    </td>
                    <td>The unit mask, as given in the events list, e.g. 0x0f</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>
                      <tt xmlns="http://www.w3.org/1999/xhtml">kernel</tt>
                    </td>
                    <td>Whether to profile kernel code</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>
                      <tt xmlns="http://www.w3.org/1999/xhtml">user</tt>
                    </td>
                    <td>Whether to profile userspace code</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The last three values are optional, if you omit them (e.g. <tt xmlns="http://www.w3.org/1999/xhtml">--event=DATA_MEM_REFS:30000</tt>),
they will be set to the default values (a unit mask of 0, and profiling both kernel and
userspace code). Note that some events require a unit mask.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
If OProfile is using RTC mode, and you want to alter the default counter value,
you can use something like <tt xmlns="http://www.w3.org/1999/xhtml">--event=RTC_INTERRUPTS:2048</tt>. Note the last
three values here are ignored.
If OProfile is using timer-interrupt mode, there is no configuration possible.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
The table below lists the events selected by default
(<tt xmlns="http://www.w3.org/1999/xhtml">--event=default</tt>) for the various computer architectures:
</p>
            <div xmlns="http://www.w3.org/1999/xhtml" class="informaltable">
              <table xmlns="http://www.w3.org/1999/xhtml" border="1">
                <colgroup xmlns="http://www.w3.org/1999/xhtml">
                  <col xmlns="http://www.w3.org/1999/xhtml"/>
                  <col xmlns="http://www.w3.org/1999/xhtml"/>
                  <col xmlns="http://www.w3.org/1999/xhtml"/>
                </colgroup>
                <tbody xmlns="http://www.w3.org/1999/xhtml">
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Processor</td>
                    <td>cpu_type</td>
                    <td>Default event</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Alpha EV4</td>
                    <td>alpha/ev4</td>
                    <td>CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Alpha EV5</td>
                    <td>alpha/ev5</td>
                    <td>CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Alpha PCA56</td>
                    <td>alpha/pca56</td>
                    <td>CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Alpha EV6</td>
                    <td>alpha/ev6</td>
                    <td>CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Alpha EV67</td>
                    <td>alpha/ev67</td>
                    <td>CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>ARM/XScale PMU1</td>
                    <td>arm/xscale1</td>
                    <td>CPU_CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>ARM/XScale PMU2</td>
                    <td>arm/xscale2</td>
                    <td>CPU_CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Athlon</td>
                    <td>i386/athlon</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium Pro</td>
                    <td>i386/ppro</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium II</td>
                    <td>i386/pii</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium III</td>
                    <td>i386/piii</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium M (P6 core)</td>
                    <td>i386/p6_mobile</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium 4 (non-HT)</td>
                    <td>i386/p4</td>
                    <td>GLOBAL_POWER_EVENTS:100000:1:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Pentium 4 (HT)</td>
                    <td>i386/p4-ht</td>
                    <td>GLOBAL_POWER_EVENTS:100000:1:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Hammer</td>
                    <td>x86-64/hammer</td>
                    <td>CPU_CLK_UNHALTED:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Itanium</td>
                    <td>ia64/itanium</td>
                    <td>CPU_CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>Itanium 2</td>
                    <td>ia64/itanium2</td>
                    <td>CPU_CYCLES:100000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>TIMER_INT</td>
                    <td>timer</td>
                    <td>None selectable</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>IBM iseries</td>
                    <td>PowerPC 4/5/970</td>
                    <td>CYCLES:10000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>IBM pseries</td>
                    <td>PowerPC 4/5/970</td>
                    <td>CYCLES:10000:0:1:1</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>IBM s390</td>
                    <td>timer</td>
                    <td>None selectable</td>
                  </tr>
                  <tr xmlns="http://www.w3.org/1999/xhtml">
                    <td>IBM s390x</td>
                    <td>timer</td>
                    <td>None selectable</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="oprofile-gui"/>2. Using <b xmlns="http://www.w3.org/1999/xhtml">oprof_start</b></h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
The <b xmlns="http://www.w3.org/1999/xhtml">oprof_start</b> application provides a convenient way to start the profiler.
Note that <b xmlns="http://www.w3.org/1999/xhtml">oprof_start</b> is just a wrapper around the <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b> script,
so it does not provide more services than the script itself.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
After <b xmlns="http://www.w3.org/1999/xhtml">oprof_start</b> is started you can select the event type for each counter;
the sampling rate and other related parameters are explained in <a xmlns="http://www.w3.org/1999/xhtml" href="#controlling-daemon" title="1. Using opcontrol">Section 1</a>.
The &quot;Configuration&quot; section allows you to set general parameters such as the buffer size, kernel filename
etc. The counter setup interface should be self-explanatory; <a xmlns="http://www.w3.org/1999/xhtml" href="#hardware-counters" title="3.1. Hardware performance counters">Section 3.1</a> and related 
links contain information on using unit masks.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
A status line shows the current status of the profiler: how long it has been running, and the average
number of interrupts received per second and the total, over all processors.
Note that quitting <b xmlns="http://www.w3.org/1999/xhtml">oprof_start</b> does not stop the profiler.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Your configuration is saved in the same file as <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b> uses; that is,
<tt xmlns="http://www.w3.org/1999/xhtml">~/.oprofile/daemonrc</tt>.
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="detailed-parameters"/>3. Configuration details</h2>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="hardware-counters"/>3.1. Hardware performance counters</h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
              <h3 class="title">Note</h3>
              <p xmlns="http://www.w3.org/1999/xhtml">
Your CPU type may not include the requisite support for hardware performance counters, in which case
you must use OProfile in RTC mode in 2.4 (see <a xmlns="http://www.w3.org/1999/xhtml" href="#rtc" title="3.2. OProfile in RTC mode">Section 3.2</a>), or timer mode in 2.6 (see <a xmlns="http://www.w3.org/1999/xhtml" href="#timer" title="3.3. OProfile in timer interrupt mode">Section 3.3</a>). 
You do not really need to read this section unless you are interested in using 
events other than the default event chosen by OProfile.
</p>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The Intel hardware performance counters are detailed in the Intel IA-32 Architecture Manual, Volume 3, available
from <a xmlns="http://www.w3.org/1999/xhtml" href="http://developer.intel.com/">http://developer.intel.com/</a>. The AMD Athlon/Duron
implementation is detailed in <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/22007.pdf">
http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/22007.pdf</a>.
For PowerPC64 processors in IBM iSeries and pSeries systems, processor documentation
is available at <a xmlns="http://www.w3.org/1999/xhtml" href="http://www-306.ibm.com/chips/techlib/techlib.nsf/productfamilies/PowerPC/">
http://www-306.ibm.com/chips/techlib/techlib.nsf/productfamilies/PowerPC</a>.  (For example, the
specific publication containing information on the performance monitor unit for the PowerPC970 is 
&quot;IBM PowerPC 970FX RISC Microprocessor User's Manual.&quot;)
These processors are capable of delivering an interrupt when a counter overflows.
This is the basic mechanism on which OProfile is based. The delivery mode is NMI,
so blocking interrupts in the kernel does not prevent profiling. When the interrupt handler is called,
the current PC value and the current task are recorded into the profiling structure.
This allows the overflow event to be attached to a specific assembly instruction in a binary image.
The daemon receives this data from the kernel, and writes it to the sample files.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
If we use an event such as <tt xmlns="http://www.w3.org/1999/xhtml">CPU_CLK_UNHALTED</tt> or <tt xmlns="http://www.w3.org/1999/xhtml">INST_RETIRED</tt>
(<tt xmlns="http://www.w3.org/1999/xhtml">GLOBAL_POWER_EVENTS</tt> or <tt xmlns="http://www.w3.org/1999/xhtml">INSTR_RETIRED</tt>, respectively, on the Pentium 4), we can
use the overflow counts as an estimate of actual time spent in each part of code. Alternatively we can profile interesting
data such as the cache behaviour of routines with the other available counters.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
However there are several caveats. First, there are those issues listed in the Intel manual. There is a delay
between the counter overflow and the interrupt delivery that can skew results on a small scale - this means
you cannot rely on the profiles at the instruction level as being perfectly accurate.
If you are using an &quot;event-mode&quot; counter such as the cache counters, a count registered against it doesn't mean
that it is responsible for that event. However, it implies that the counter overflowed in the dynamic
vicinity of that instruction, to within a few instructions. Further details on this problem can be found in 
<a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting" title="Chapter 5. Interpreting profiling results">Chapter 5</a> and also in the Digital paper &quot;ProfileMe: A Hardware Performance Counter&quot;.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Each counter has several configuration parameters.
First, there is the unit mask: this simply further specifies what to count.
Second, there is the counter value, discussed below. Third, there is a parameter whether to increment counts
whilst in kernel or user space. You can configure these separately for each counter.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
After each overflow event, the counter will be re-initialized
such that another overflow will occur after this many events have been counted. Thus, higher
values mean less-detailed profiling, and lower values mean more detail, but higher overhead.
Picking a good value for this
parameter is, unfortunately, somewhat of a black art. It is of course dependent on the event
you have chosen.
Specifying too large a value will mean not enough interrupts are generated
to give a realistic profile (though this problem can be ameliorated by profiling for <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">longer</i></span>).
Specifying too small a value can lead to higher performance overhead.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="rtc"/>3.2. OProfile in RTC mode</h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
              <h3 class="title">Note</h3>
              <p xmlns="http://www.w3.org/1999/xhtml">
This section applies to 2.2/2.4 kernels only.
</p>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Some CPU types do not provide the needed hardware support to use the hardware performance counters. This includes
some laptops, classic Pentiums, and other CPU types not yet supported by OProfile (such as Cyrix). 
On these machines, OProfile falls
back to using the real-time clock interrupt to collect samples. This interrupt is also used by the <b xmlns="http://www.w3.org/1999/xhtml">rtc</b>
module: you cannot have both the OProfile and rtc modules loaded nor the rtc support compiled in the kernel.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
RTC mode is less capable than the hardware counters mode; in particular, it is unable to profile sections of
the kernel where interrupts are disabled. There is just one available event, &quot;RTC interrupts&quot;, and its value 
corresponds to the number of interrupts generated per second (that is, a higher number means a better profiling
resolution, and higher overhead). The current implementation of the real-time clock supports only power-of-two
sampling rates from 2 to 4096 per second.  Other values within this range are rounded to the nearest power of
two.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
You can force use of the RTC interrupt with the <tt xmlns="http://www.w3.org/1999/xhtml">force_rtc=1</tt> module parameter.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Setting the value from the GUI should be straightforward. On the command line, you need to specify the
event to <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b>, e.g. :
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
              <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --event=RTC_INTERRUPTS:256</b>
            </p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="timer"/>3.3. OProfile in timer interrupt mode</h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
              <h3 class="title">Note</h3>
              <p xmlns="http://www.w3.org/1999/xhtml">
This section applies to 2.6 kernels and above only.
</p>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
In 2.6 kernels on CPUs without OProfile support for the hardware performance counters, the driver
falls back to using the timer interrupt for profiling. Like the RTC mode in 2.4 kernels, this is not able to
profile code that has interrupts disabled. Note that there are no configuration parameters for
setting this, unlike the RTC and hardware performance counter setup.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
You can force use of the timer interrupt by using the <tt xmlns="http://www.w3.org/1999/xhtml">timer=1</tt> module
parameter (or <tt xmlns="http://www.w3.org/1999/xhtml">oprofile.timer=1</tt> on the boot command line if OProfile is
built-in).
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="p4"/>3.4. Pentium 4 support</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The Pentium 4 / Xeon performance counters are organized around 3 types of model specific registers (MSRs): 45 event
selection control registers (ESCRs), 18 counter configuration control registers (CCCRs) and 18 counters. ESCRs describe a
particular set of events which are to be recorded, and CCCRs bind ESCRs to counters and configure their
operation. Unfortunately the relationship between these registers is quite complex; they cannot all be used with one
another at any time. There is, however, a subset of 8 counters, 8 ESCRs, and 8 CCCRs which can be used independently of
one another, so OProfile only accesses those registers, treating them as a bank of 8 &quot;normal&quot; counters, similar
to those in the P6 or Athlon families of CPU.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
There is currently no support for Precision Event-Based Sampling (PEBS), nor any advanced uses of the Debug Store
(DS). Current support is limited to the conservative extension of OProfile's existing interrupt-based model described
above.  Performance monitoring hardware on Pentium 4 / Xeon processors with Hyperthreading enabled (multiple logical
processors on a single die) is not supported in 2.4 kernels (you can use OProfile if you disable hyper-threading,
though).
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="ia64"/>3.5. Intel Itanium 2 support</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The Itanium 2 performance monitoring unit (PMU) organizes the counters as four
pairs of performance event monitoring registers. Each pair is composed of a
Performance Monitoring Configuration (PMC) register and Performance Monitoring
Data (PMD) register.  The PMC selects the performance event being monitored and
the PMD determines the sampling interval. The IA64 Performance Monitoring Unit
(PMU) triggers sampling with maskable interrupts. Thus, samples will not occur
in sections of the IA64 kernel where interrupts are disabled.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
None of the advance features of the Itanium 2 performance monitoring unit
such as opcode matching, address range matching, or precise event sampling are
supported by this version of OProfile.  The Itanium 2 support only maps OProfile's
existing interrupt-based model to the PMU hardware.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="ppc64"/>3.6. PowerPC64 support</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The performance monitoring unit (PMU) for the PowerPC 64-bit processors 
consists of between 6 and 8 counters (depending on the model), plus three
special purpose registers used for programming the counters -- MMCR0, MMCR1,
and MMCRA.  Advanced features such as instruction matching and thresholding are
not supported by this version of OProfile.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="misuse"/>3.7. Dangerous counter settings</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
OProfile is a low-level profiler which allow continuous profiling with a low-overhead cost.
If too low a count reset value is set for a counter, the system can become overloaded with counter
interrupts, and seem as if the system has frozen. Whilst some validation is done, it
is not foolproof.
</p>
            <div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
              <h3 class="title">Note</h3>
              <p xmlns="http://www.w3.org/1999/xhtml">
This can happen as follows: When the profiler count
reaches zero an NMI handler is called which stores the sample values in an internal buffer, then resets the counter
to its original value. If the count is very low, a pending NMI can be sent before the NMI handler has
completed. Due to the priority of the NMI, the local APIC delivers the pending interrupt immediately after
completion of the previous interrupt handler, and control never returns to other parts of the system.
In this way the system seems to be frozen.
</p>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">If this happens, it will be impossible to bring the system back to a workable state.
There is no way to provide real security against this happening, other than making sure to use a reasonable value
for the counter reset. For example, setting <tt xmlns="http://www.w3.org/1999/xhtml">CPU_CLK_UNHALTED</tt> event type with a ridiculously low reset count (e.g. 500)
is likely to freeze the system.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
In short : <b xmlns="http://www.w3.org/1999/xhtml">Don't try a foolish sample count value</b>. Unfortunately the definition of a foolish value
is really dependent on the event type - if ever in doubt, e-mail </p>
            <div xmlns="http://www.w3.org/1999/xhtml" class="address">
              <p><tt xmlns="http://www.w3.org/1999/xhtml">&lt;<a xmlns="http://www.w3.org/1999/xhtml" href="mailto:oprofile-list@lists.sf.net">oprofile-list@lists.sf.net</a>&gt;</tt>.</p>
            </div>
          </div>
        </div>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="results"/>Chapter 4. Obtaining results</h2>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
          <p xmlns="http://www.w3.org/1999/xhtml">
            <b>Table of Contents</b>
          </p>
          <dl>
            <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec">Profile specifications</a></dt>
            <dd>
              <dl>
                <dt>1.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec-examples">Examples</a></dt>
                <dt>1.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#profile-spec-details">Profile specification parameters</a></dt>
                <dt>1.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#id2816552">Locating and managing binary images</a></dt>
                <dt>1.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#no-results">What to do when you don't get any results</a></dt>
              </dl>
            </dd>
            <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport">Image summaries and symbol summaries (opreport)</a></dt>
            <dd>
              <dl>
                <dt>2.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-merging">Merging separate profiles</a></dt>
                <dt>2.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-comparison">Side-by-side multiple results</a></dt>
                <dt>2.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-callgraph">Callgraph output</a></dt>
                <dt>2.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-diff">Differential profiles with opreport</a></dt>
                <dt>2.5. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-anon">Anonymous executable mappings</a></dt>
                <dt>2.6. <a xmlns="http://www.w3.org/1999/xhtml" href="#opreport-options">Options for opreport</a></dt>
              </dl>
            </dd>
            <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate">Outputting annotated source (opannotate)</a></dt>
            <dd>
              <dl>
                <dt>3.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate-finding-source">Locating source files</a></dt>
                <dt>3.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#opannotate-details">Usage of opannotate</a></dt>
              </dl>
            </dd>
            <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#opgprof">gprof-compatible output (opgprof)</a></dt>
            <dd>
              <dl>
                <dt>4.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opgprof-details">Usage of opgprof</a></dt>
              </dl>
            </dd>
            <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#oparchive">Archiving measurements (oparchive)</a></dt>
            <dd>
              <dl>
                <dt>5.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#oparchive-details">Usage of oparchive</a></dt>
              </dl>
            </dd>
            <dt>6. <a xmlns="http://www.w3.org/1999/xhtml" href="#opimport">Converting sample database files (opimport)</a></dt>
            <dd>
              <dl>
                <dt>6.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#opimport-details">Usage of opimport</a></dt>
              </dl>
            </dd>
          </dl>
        </div>
        <p xmlns="http://www.w3.org/1999/xhtml">
OK, so the profiler has been running, but it's not much use unless we can get some data out. Fairly often,
OProfile does a little <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">too</i></span> good a job of keeping overhead low, and no data reaches
the profiler. This can happen on lightly-loaded machines. Remember you can force a dump at any time with :
</p>
        <p xmlns="http://www.w3.org/1999/xhtml">
          <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --dump</b>
        </p>
        <p xmlns="http://www.w3.org/1999/xhtml">Remember to do this before complaining there is no profiling data !
Now that we've got some data, it has to be processed. That's the job of <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>,
<b xmlns="http://www.w3.org/1999/xhtml">opannotate</b>, or <b xmlns="http://www.w3.org/1999/xhtml">opgprof</b>.
</p>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="profile-spec"/>1. Profile specifications</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
All of the analysis tools take a <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">profile specification</i></span>.
This is a set of definitions that describe which actual profiles should be
examined. The simplest profile specification is empty: this will match all
the available profile files for the current session (this is what happens
when you do <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>).
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Specification parameters are of the form <tt xmlns="http://www.w3.org/1999/xhtml">name:value[,value]</tt>.
For example, if I wanted to get a combined symbol summary for
<tt xmlns="http://www.w3.org/1999/xhtml">/bin/myprog</tt> and <tt xmlns="http://www.w3.org/1999/xhtml">/bin/myprog2</tt>,
I could do <b xmlns="http://www.w3.org/1999/xhtml">opreport -l image:/bin/myprog,/bin/myprog2</b>.
As a special case, you don't actually need to specify the <tt xmlns="http://www.w3.org/1999/xhtml">image:</tt>
part here: anything left on the command line is assumed to be an
<tt xmlns="http://www.w3.org/1999/xhtml">image:</tt> name. Similarly, if no <tt xmlns="http://www.w3.org/1999/xhtml">session:</tt>
is specified, then <tt xmlns="http://www.w3.org/1999/xhtml">session:current</tt> is assumed (&quot;current&quot;
is a special name of the current / last profiling session).
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
In addition to the comma-separated list shown above, some of the 
specification parameters can take <b xmlns="http://www.w3.org/1999/xhtml">glob</b>-style
values. For example, if I want to see image summaries for all
binaries profiled in <tt xmlns="http://www.w3.org/1999/xhtml">/usr/bin/</tt>, I could do
<b xmlns="http://www.w3.org/1999/xhtml">opreport image:/usr/bin/\*</b>. Note the necessity
to escape the special character from the shell.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
For <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>, profile specifications can be used to
define two profiles, giving differential output. This is done by
enclosing each of the two specifications within curly braces, as shown
in the examples below. Any specifications outside of curly braces are
shared across both.
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="profile-spec-examples"/>1.1. Examples</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Image summaries for all profiles with <tt xmlns="http://www.w3.org/1999/xhtml">DATA_MEM_REFS</tt>
samples in the saved session called &quot;stresstest&quot; :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
# opreport session:stresstest event:DATA_MEM_REFS
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Symbol summary for the application called &quot;test_sym53c8xx,9xx&quot;. Note the
escaping is necessary as <tt xmlns="http://www.w3.org/1999/xhtml">image:</tt> takes a comma-separated list.
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
# opreport -l ./test/test_sym53c8xx\,9xx
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Image summaries for all binaries in the <tt xmlns="http://www.w3.org/1999/xhtml">test</tt> directory,
excepting <tt xmlns="http://www.w3.org/1999/xhtml">boring-test</tt> :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
# opreport image:./test/\* image-exclude:./test/boring-test
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Differential profile of a binary stored in two archives :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
# opreport -l /bin/bash { archive:./orig } { archive:./new }
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Differential profile of an archived binary with the current session :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
# opreport -l /bin/bash { archive:./orig } { }
</pre>
                </td>
              </tr>
            </table>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="profile-spec-details"/>1.2. Profile specification parameters</h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">archive:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">archivepath</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		A path to an archive made with <b xmlns="http://www.w3.org/1999/xhtml">oparchive</b>.
		Absence of this tag, unlike others, means &quot;the current system&quot;,
		equivalent to specifying &quot;archive:&quot;.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">session:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">sessionlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		A comma-separated list of session names to resolve in. Absence of this
		tag, unlike others, means &quot;the current session&quot;, equivalent to
		specifying &quot;session:current&quot;.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">session-exclude:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">sessionlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
                A comma-separated list of sessions to exclude.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">image:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">imagelist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
                A comma-separated list of image names to resolve. Each entry may be relative
                path, <b xmlns="http://www.w3.org/1999/xhtml">glob</b>-style name, or full path, e.g.</p>
                  <table border="0" style="background: #E0E0E0;" width="90%">
                    <tr>
                      <td>
                        <pre class="screen">opreport 'image:/usr/bin/oprofiled,*op*,./opreport'</pre>
                      </td>
                    </tr>
                  </table>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">image-exclude:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">imagelist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Same as <tt xmlns="http://www.w3.org/1999/xhtml">image:</tt>, but the matching images are excluded.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">lib-image:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">imagelist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Same as <tt xmlns="http://www.w3.org/1999/xhtml">image:</tt>, but only for images that are for
		a particular primary binary image (namely, an application). This only
		makes sense to use if you're using <tt xmlns="http://www.w3.org/1999/xhtml">--separate</tt>.
		This includes kernel modules and the kernel when using
		<tt xmlns="http://www.w3.org/1999/xhtml">--separate=kernel</tt>.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">lib-image-exclude:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">imagelist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Same as <tt xmlns="http://www.w3.org/1999/xhtml">lib-image:</tt>, but the matching images
		are excluded.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">event:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">eventlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		The symbolic event name to match on, e.g. <tt xmlns="http://www.w3.org/1999/xhtml">event:DATA_MEM_REFS</tt>.
		You can pass a list of events for side-by-side comparison with <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>.
		When using the timer interrupt, the event is always &quot;TIMER&quot;.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">count:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">eventcountlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		The event count to match on, e.g. <tt xmlns="http://www.w3.org/1999/xhtml">event:DATA_MEM_REFS count:30000</tt>.
		Note that this value refers to the setting used for <b xmlns="http://www.w3.org/1999/xhtml">opcontrol</b>
		only, and has nothing to do with the sample counts in the profile data
		itself.
		You can pass a list of events for side-by-side comparison with <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>.
		When using the timer interrupt, the count is always 0 (indicating it cannot be set).
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">unit-mask:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">masklist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		The unit mask value of the event to match on, e.g. <tt xmlns="http://www.w3.org/1999/xhtml">unit-mask:1</tt>.
		You can pass a list of events for side-by-side comparison with <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">cpu:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">cpulist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Only consider profiles for the given numbered CPU (starting from zero).
		This is only useful when using CPU profile separation.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">tgid:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">pidlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Only consider profiles for the given task groups. Unless some program
		is using threads, the task group ID of a process is the same
		as its process ID. This option corresponds to the POSIX
		notion of a thread group.
		This is only useful when using per-process profile separation.
		</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">tid:</tt>
                    <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis">
                      <i xmlns="http://www.w3.org/1999/xhtml">tidlist</i>
                    </span>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
		Only consider profiles for the given threads. When using
		recent thread libraries, all threads in a process share the
		same task group ID, but have different thread IDs. You can
		use this option in combination with <tt xmlns="http://www.w3.org/1999/xhtml">tgid:</tt> to
		restrict the results to particular threads within a process.
		This is only useful when using per-process profile separation.
		</p>
                </dd>
              </dl>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="id2816552"/>1.3. Locating and managing binary images</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Each session's sample files can be found in the <tt xmlns="http://www.w3.org/1999/xhtml">/var/lib/oprofile/samples/</tt> directory.
These are used, along with the binary image files, to produce human-readable data.
In some circumstances (kernel modules in an initrd, or modules on 2.6 kernels), OProfile
will not be able to find the binary images. All the tools have an <tt xmlns="http://www.w3.org/1999/xhtml">--image-path</tt>
option to which you can pass a comma-separated list of alternate paths to search. For example,
I can let OProfile find my 2.6 modules by using <b xmlns="http://www.w3.org/1999/xhtml">--image-path /lib/modules/2.6.0/kernel/</b>.
It is your responsibility to ensure that the correct images are found when using this
option.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Note that if a binary image changes after the sample file was created, you won't be able to get useful
symbol-based data out. This situation is detected for you. If you replace a binary, you should
make sure to save the old binary if you need to do comparative profiles.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="no-results"/>1.4. What to do when you don't get any results</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
When attempting to get output, you may see the error :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
error: no sample files found: profile specification too strict ?
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
What this is saying is that the profile specification you passed in,
when matched against the available sample files, resulted in no matches.
There are a number of reasons this might happen:
</p>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">spelling</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
You specified a binary name, but spelt it wrongly. Check your spelling !
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">profiler wasn't running</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Make very sure that OProfile was actually up and running when you ran
the binary.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">binary didn't run long enough</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Remember OProfile is a statistical profiler - you're not guaranteed to
get samples for short-running programs. You can help this by using a
lower count for the performance counter, so there are a lot more samples
taken per second.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">binary spent most of its time in libraries</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Similarly, if the binary spends little time in the main binary image
itself, with most of it spent in shared libraries it uses, you might
not see any samples for the binary image itself. You can check this
by using <b xmlns="http://www.w3.org/1999/xhtml">opcontrol --separate=lib</b> before the
profiling session, so <b xmlns="http://www.w3.org/1999/xhtml">opreport</b> and friends show
the library profiles on a per-application basis.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">specification was really too strict</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
For example, you specified something like <tt xmlns="http://www.w3.org/1999/xhtml">tgid:3433</tt>,
but no task with that group ID ever ran the code.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">binary didn't generate any events</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
If you're using a particular event counter, for example counting MMX
operations, the code might simply have not generated any events in the
first place. Verify the code you're profiling does what you expect it
to.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">you didn't specify kernel module name correctly</span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
If you're using 2.6 kernels, and trying to get reports for a kernel
module, make sure to use the <tt xmlns="http://www.w3.org/1999/xhtml">-p</tt> option, and specify the
module name <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">with</i></span> the <tt xmlns="http://www.w3.org/1999/xhtml">.ko</tt>
extension. Check if the module is one loaded from initrd.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport"/>2. Image summaries and symbol summaries (<b xmlns="http://www.w3.org/1999/xhtml">opreport</b>)</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
The <b xmlns="http://www.w3.org/1999/xhtml">opreport</b> utility is the primary utility you will use for 
getting formatted data out of OProfile. It produces two types of data: image summaries
and symbol summaries. An image summary lists the number of samples for individual
binary images such as libraries or applications. Symbol summaries provide per-symbol
profile data. In the following example, we're getting an image summary for the whole
system:
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opreport --long-filenames
CPU: PIII, speed 863.195 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 23150
   905898 59.7415 /usr/lib/gcc-lib/i386-redhat-linux/3.2/cc1plus
   214320 14.1338 /boot/2.6.0/vmlinux
   103450  6.8222 /lib/i686/libc-2.3.2.so
    60160  3.9674 /usr/local/bin/madplay
    31769  2.0951 /usr/local/oprofile-pp/bin/oprofiled
    26550  1.7509 /usr/lib/libartsflow.so.1.0.0
    23906  1.5765 /usr/bin/as
    18770  1.2378 /oprofile
    15528  1.0240 /usr/lib/qt-3.0.5/lib/libqt-mt.so.3.0.5
    11979  0.7900 /usr/X11R6/bin/XFree86
    11328  0.7471 /bin/bash
    ...
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
If we had specified <tt xmlns="http://www.w3.org/1999/xhtml">--symbols</tt> in the previous command, we would have
gotten a symbol summary of all the images across the entire system. We can restrict this to only
part of the system profile; for example,
below is a symbol summary of the OProfile daemon. Note that as we used
<b xmlns="http://www.w3.org/1999/xhtml">opcontrol --separate=kernel</b>, symbols from images that <b xmlns="http://www.w3.org/1999/xhtml">oprofiled</b>
has used are also shown.
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opreport -l `which oprofiled` 2&gt;/dev/null | more
CPU: PIII, speed 863.195 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 23150
vma      samples  %           image name               symbol name
0804be10 14971    28.1993     oprofiled                odb_insert
0804afdc 7144     13.4564     oprofiled                pop_buffer_value
c01daea0 6113     11.5144     vmlinux                  __copy_to_user_ll
0804b060 2816      5.3042     oprofiled                opd_put_sample
0804b4a0 2147      4.0441     oprofiled                opd_process_samples
0804acf4 1855      3.4941     oprofiled                opd_put_image_sample
0804ad84 1766      3.3264     oprofiled                opd_find_image
0804a5ec 1084      2.0418     oprofiled                opd_find_module
0804ba5c 741       1.3957     oprofiled                odb_hash_add_node
...
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
These are the two basic ways you are most likely to use regularly, but <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>
can do a lot more than that, as described below.
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2"><div xmlns="http://www.w3.org/1999/xhtml" class="titlepage"><div xmlns="http://www.w3.org/1999/xhtml"><h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-merging"/>2.1. Merging separate profiles</h3></div></div>

If you have used one of the <tt xmlns="http://www.w3.org/1999/xhtml">--separate=</tt> options
whilst profiling, there can be several separate profiles for
a single binary image within a session. Normally the output
will keep these images separated (so, for example, the image summary
output shows library image summaries on a per-application basis,
when using <tt xmlns="http://www.w3.org/1999/xhtml">--separate=lib</tt>).
Sometimes it can be useful to merge these results back together
before getting results. The <tt xmlns="http://www.w3.org/1999/xhtml">--merge</tt> option allows
you to do that.
</div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2"><div xmlns="http://www.w3.org/1999/xhtml" class="titlepage"><div xmlns="http://www.w3.org/1999/xhtml"><h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-comparison"/>2.2. Side-by-side multiple results</h3></div></div>
If you have used multiple events when profiling, by default you get
side-by-side results of each event's sample values from <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>.
You can restrict which events to list by appropriate use of the
<tt xmlns="http://www.w3.org/1999/xhtml">event:</tt> profile specifications, etc.
</div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-callgraph"/>2.3. Callgraph output</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
When using the <tt xmlns="http://www.w3.org/1999/xhtml">opcontrol --callgraph</tt> option, you can see what
functions are calling other functions in the output. Consider the
following program:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

#define SIZE 500000

static int compare(const void *s1, const void *s2)
{
        return strcmp(s1, s2);
}

static void repeat(void)
{
        int i;
        char *strings[SIZE];
        char str[] = &quot;abcdefghijklmnopqrstuvwxyz&quot;;

        for (i = 0; i &lt; SIZE; ++i) {
                strings[i] = strdup(str);
                strfry(strings[i]);
        }

        qsort(strings, SIZE, sizeof(char *), compare);
}

int main()
{
        while (1)
                repeat();
}
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
When running with the call-graph option, OProfile will
record the function stack every time it takes a sample.
<b xmlns="http://www.w3.org/1999/xhtml">opreport --callgraph</b> outputs an entry for each
function, where each entry looks similar to:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
samples  %        image name               symbol name
  197       0.1548  cg                       main
  127036   99.8452  cg                       repeat
84590    42.5084  libc-2.3.2.so            strfry
  84590    66.4838  libc-2.3.2.so            strfry [self]
  39169    30.7850  libc-2.3.2.so            random_r
  3475      2.7312  libc-2.3.2.so            __i686.get_pc_thunk.bx
-------------------------------------------------------------------------------
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Here the non-indented line is the function we're focussing upon
(<tt xmlns="http://www.w3.org/1999/xhtml">strfry()</tt>). This
line is the same as you'd get from a normal <b xmlns="http://www.w3.org/1999/xhtml">opreport</b>
output.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Above the non-indented line we find the functions that called this
function (for example, <tt xmlns="http://www.w3.org/1999/xhtml">repeat()</tt> calls
<tt xmlns="http://www.w3.org/1999/xhtml">strfry()</tt>). The samples and percentage values here
refer to the number of times we took a sample where this call was found
in the stack; the percentage is relative to all other callers of the
function we're focussing on. Note that these values are
<span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">not</i></span> call counts; they only reflect the call stack
every time a sample is taken; that is, if a call is found in the stack
at the time of a sample, it is recorded in this count.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Below the line are functions that are called by
<tt xmlns="http://www.w3.org/1999/xhtml">strfry()</tt> (called <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">callees</i></span>).
It's clear here that <tt xmlns="http://www.w3.org/1999/xhtml">strfry()</tt> calls
<tt xmlns="http://www.w3.org/1999/xhtml">random_r()</tt>. We also see a special entry with a
&quot;[self]&quot; marker. This records the normal samples for the function, but
the percentage becomes relative to all callees. This allows you to
compare time spent in the function itself compared to functions it
calls. Note that if a function calls itself, then it will appear in the
list of callees of itself, but without the &quot;[self]&quot; marker; so recursive
calls are still clearly separable.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
You may have noticed that the output lists <tt xmlns="http://www.w3.org/1999/xhtml">main()</tt>
as calling <tt xmlns="http://www.w3.org/1999/xhtml">strfry()</tt>, but it's clear from the source
that this doesn't actually happen. See <a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting-callgraph" title="3. Interpreting call-graph profiles">Section 3</a> for an explanation.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-diff"/>2.4. Differential profiles with <b xmlns="http://www.w3.org/1999/xhtml">opreport</b></h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Often, we'd like to be able to compare two profiles. For example, when
analysing the performance of an application, we'd like to make code
changes and examine the effect of the change. This is supported in
<b xmlns="http://www.w3.org/1999/xhtml">opreport</b> by giving a profile specification that
identifies two different profiles. The general form is of:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
$ opreport &lt;shared-spec&gt; { &lt;first-profile&gt; } { &lt;second-profile&gt; }
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
For each of the profiles, the shared section is prefixed, and then the
specification is analysed. The usual parameters work both within the
shared section, and in the sub-specification within the curly braces.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
A typical way to use this feature is with archives created with
<b xmlns="http://www.w3.org/1999/xhtml">oparchive</b>. Let's look at an example:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
$ ./a
$ oparchive -o orig ./a
$ opcontrol --reset
  # edit and recompile a
$ ./a
  # now compare the current profile of a with the archived profile
$ opreport -xl ./a { archive:./orig } { }
CPU: PIII, speed 863.233 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a
unit mask of 0x00 (No unit mask) count 100000
samples  %        diff %    symbol name
92435    48.5366  +0.4999   a
54226    ---      ---       c
49222    25.8459  +++       d
48787    25.6175  -2.2e-01  b
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Note that we specified an empty second profile in the curly braces, as
we wanted to use the current session; alternatively, we could
have specified another archive, or a tgid etc. We specified the binary
<b xmlns="http://www.w3.org/1999/xhtml">a</b> in the shared section, so we matched that in both
the profiles we're diffing.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
As in the normal output, the results are sorted by the number of
samples, and the percentage field represents the relative percentage of
the symbol's samples in the second profile.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Notice the new column in the output. This value represents the
percentage change of the relative percent between the first and the
second profile: roughly, &quot;how much more important this symbol is&quot;.
Looking at the symbol <tt xmlns="http://www.w3.org/1999/xhtml">a()</tt>, we can see that it took
roughly the same amount of the total profile in both the first and the
second profile. The function <tt xmlns="http://www.w3.org/1999/xhtml">c()</tt> was not in the new
profile, so has been marked with <tt xmlns="http://www.w3.org/1999/xhtml">---</tt>. Note that the
sample value is the number of samples in the first profile; since we're
displaying results for the second profile, we don't list a percentage
value for it, as it would be meaningless. <tt xmlns="http://www.w3.org/1999/xhtml">d()</tt> is
new in the second profile, and consequently marked with
<tt xmlns="http://www.w3.org/1999/xhtml">+++</tt>.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
When comparing profiles between different binaries, it should be clear
that functions can change in terms of VMA and size. To avoid this
problem, <b xmlns="http://www.w3.org/1999/xhtml">opreport</b> considers a symbol to be the same
if the symbol name, image name, and owning application name all match;
any other factors are ignored. Note that the check for application name
means that trying to compare library profiles between two different
applications will not work as you might expect: each symbol will be
considered different.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-anon"/>2.5. Anonymous executable mappings</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Many applications, typically ones involving dynamic compilation into
machine code, have executable mappings that are not backed by an ELF
file. <b xmlns="http://www.w3.org/1999/xhtml">opreport</b> has basic support for showing the
samples taken in these regions; for example:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
$ opreport /usr/jre1.5.0/bin/java
CPU: PIII, speed 863.195 MHz (estimated)
Counted CPU_CLK_UNHALTED events (clocks processor is not halted) with a unit mask of 0x00 (No unit mask) count 100000
CPU_CLK_UNHALT...|
  samples|      %|
------------------
    27344 100.000 java
        CPU_CLK_UNHALT...|
          samples|      %|
        ------------------
            27236  99.605 anon (tgid:12135 range:0xb2cb8000-0xb2e80000)
              108  0.3949 java
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Currently, there is no support for getting symbol-based summaries for
such regions. Note that, since such mappings are dependent upon
individual invocations of a binary, these mappings are always listed as
a dependent image, even when using <tt xmlns="http://www.w3.org/1999/xhtml">--separate=none</tt>.
Equally, the results are not affected by the <tt xmlns="http://www.w3.org/1999/xhtml">--merge</tt>
option.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opreport-options"/>2.6. Options for <b xmlns="http://www.w3.org/1999/xhtml">opreport</b></h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--accumulated / -a</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Accumulate sample and percentage counts in the symbol list.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--callgraph / -c</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show callgraph information.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--debug-info / -g</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show source file and line for each symbol.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--demangle / -D none|normal|smart</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
none: no demangling. normal: use default demangler (default) smart: use
pattern-matching to make C++ symbol demangling more readable.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--details / -d</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show per-instruction details for all selected symbols. Note that, for
binaries without symbol information, the VMA values shown are raw file
offsets for the image binary.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-dependent / -x</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Do not include application-specific images for libraries, kernel modules
and the kernel. This option only makes sense if the profile session
used --separate.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-symbols / -e [symbols]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Exclude all the symbols in the given comma-separated list.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--global-percent / -%</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Make all percentages relative to the whole profile.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--help / -? / --usage</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show help message.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--image-path / -p [paths]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of additional paths to search for binaries.
This is needed to find modules in kernels 2.6 and upwards.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--include-symbols / -i [symbols]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only include symbols in the given comma-separated list.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--long-filenames / -l</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output full paths instead of basenames.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--merge / -m [lib,cpu,tid,tgid,unitmask,all]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Merge any profiles separated in a --separate session.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--no-header</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Don't output a header detailing profiling parameters.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--output-file / -o [file]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output to the given file instead of stdout.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--reverse-sort / -r</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Reverse the sort from the default.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--show-address / -w</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show the VMA address of each symbol (off by default).
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--sort / -s [vma,sample,symbol,debug,image]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Sort the list of symbols by, respectively, symbol address,
number of samples, symbol name, debug filename and line number,
binary image filename.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--symbols / -l</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
List per-symbol information instead of a binary image summary.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--threshold / -t [percentage]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only output data for symbols that have more than the given percentage
of total samples.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--verbose / -V [options]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Give verbose debugging output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--version / -v</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show version.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="opannotate"/>3. Outputting annotated source (<b xmlns="http://www.w3.org/1999/xhtml">opannotate</b>)</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
The <b xmlns="http://www.w3.org/1999/xhtml">opannotate</b> utility generates annotated source files or assembly listings, optionally
mixed with source.
If you want to see the source file, the profiled application needs to have debug information, and the source
must be available through this debug information. For GCC, you must use the <tt xmlns="http://www.w3.org/1999/xhtml">-g</tt> option
when you are compiling.
If the binary doesn't contain sufficient debug information, you can still
use <b xmlns="http://www.w3.org/1999/xhtml">opannotate <tt xmlns="http://www.w3.org/1999/xhtml">--assembly</tt></b> to get annotated assembly.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Note that for the reason explained in <a xmlns="http://www.w3.org/1999/xhtml" href="#hardware-counters" title="3.1. Hardware performance counters">Section 3.1</a> the results can be
inaccurate. The debug information itself can add other problems; for example, the line number for a symbol can be
incorrect. Assembly instructions can be re-ordered and moved by the compiler, and this can lead to
crediting source lines with samples not really &quot;owned&quot; by this line. Also see
<a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting" title="Chapter 5. Interpreting profiling results">Chapter 5</a>.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
You can output the annotation to one single file, containing all the source found using the
<tt xmlns="http://www.w3.org/1999/xhtml">--source</tt>. You can use this in conjunction with <tt xmlns="http://www.w3.org/1999/xhtml">--assembly</tt>
to get combined source/assembly output.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
You can also output a directory of annotated source files that maintains the structure of
the original sources. Each line in the annotated source is prepended with the samples
for that line. Additionally, each symbol is annotated giving details for the symbol
as a whole. An example:
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opannotate --source --output-dir=annotated /usr/local/oprofile-pp/bin/oprofiled
$ ls annotated/home/moz/src/oprofile-pp/daemon/
opd_cookie.h  opd_image.c  opd_kernel.c  opd_sample_files.c  oprofiled.c
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Line numbers are maintained in the source files, but each file has
a footer appended describing the profiling details. The actual annotation
looks something like this :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
...
               :static uint64_t pop_buffer_value(struct transient * trans)
 11510  1.9661 :{ /* pop_buffer_value total:  89901 15.3566 */
               :        uint64_t val;
               :
 10227  1.7469 :        if (!trans-&gt;remaining) {
               :                fprintf(stderr, &quot;BUG: popping empty buffer !\n&quot;);
               :                exit(EXIT_FAILURE);
               :        }
               :
               :        val = get_buffer_value(trans-&gt;buffer, 0);
  2281  0.3896 :        trans-&gt;remaining--;
  2296  0.3922 :        trans-&gt;buffer += kernel_pointer_size;
               :        return val;
 10454  1.7857 :}
...
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
The first number on each line is the number of samples, whilst the second is
the relative percentage of total samples.
</p>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opannotate-finding-source"/>3.1. Locating source files</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Of course, <b xmlns="http://www.w3.org/1999/xhtml">opannotate</b> needs to be able to locate the source files
for the binary image(s) in order to produce output. Some binary images have debug
information where the given source file paths are relative, not absolute. You can
specify search paths to look for these files (similar to <b xmlns="http://www.w3.org/1999/xhtml">gdb</b>'s
<tt xmlns="http://www.w3.org/1999/xhtml">dir</tt> command) with the <tt xmlns="http://www.w3.org/1999/xhtml">--search-dirs</tt> option.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Sometimes you may have a binary image which gives absolute paths for the source files,
but you have the actual sources elsewhere (commonly, you've installed an SRPM for
a binary on your system and you want annotation from an existing profile). You can
use the <tt xmlns="http://www.w3.org/1999/xhtml">--base-dirs</tt> option to redirect OProfile to look somewhere
else for source files. For example, imagine we have a binary generated from a source
file that is given in the debug information as <tt xmlns="http://www.w3.org/1999/xhtml">/tmp/build/libfoo/foo.c</tt>,
and you have the source tree matching that binary installed in <tt xmlns="http://www.w3.org/1999/xhtml">/home/user/libfoo/</tt>.
You can redirect OProfile to find <tt xmlns="http://www.w3.org/1999/xhtml">foo.c</tt> correctly like this :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
$ opannotate --source --base-dirs=/tmp/build/libfoo/ --search-dirs=/home/user/libfoo/ --output-dir=annotated/ /lib/libfoo.so
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
You can specify multiple (comma-separated) paths to both options.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opannotate-details"/>3.2. Usage of <b xmlns="http://www.w3.org/1999/xhtml">opannotate</b></h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--assembly / -a</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output annotated assembly. If this is combined with --source, then mixed
source / assembly annotations are output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--base-dirs / -b [paths]/</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of path prefixes. This can be used to point OProfile to a
different location for source files when the debug information specifies an
absolute path on your system for the source that does not exist. The prefix
is stripped from the debug source file paths, then searched in the search dirs
specified by <tt xmlns="http://www.w3.org/1999/xhtml">--search-dirs</tt>.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--demangle / -D none|normal|smart</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
none: no demangling. normal: use default demangler (default) smart: use
pattern-matching to make C++ symbol demangling more readable.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-dependent / -x</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Do not include application-specific images for libraries, kernel modules
and the kernel. This option only makes sense if the profile session
used --separate.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-file [files]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Exclude all files in the given comma-separated list of glob patterns.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-symbols / -e [symbols]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Exclude all the symbols in the given comma-separated list.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--help / -? / --usage</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show help message.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--image-path / -p [paths]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of additional paths to search for binaries.
This is needed to find modules in kernels 2.6 and upwards.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--include-file [files]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only include files in the given comma-separated list of glob patterns.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--include-symbols / -i [symbols]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only include symbols in the given comma-separated list.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--objdump-params [params]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Pass the given parameters as extra values when calling objdump.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--output-dir / -o [dir]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output directory. This makes opannotate output one annotated file for each
source file. This option can't be used in conjunction with --assembly.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--search-dirs / -d [paths]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of paths to search for source files. This is useful to find
source files when the debug information only contains relative paths.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--source / -s</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output annotated source. This requires debugging information to be available
for the binaries.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--threshold / -t [percentage]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only output data for symbols that have more than the given percentage
of total samples.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--verbose / -V [options]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Give verbose debugging output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--version / -v</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show version.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="opgprof"/>4. <b xmlns="http://www.w3.org/1999/xhtml">gprof</b>-compatible output (<b xmlns="http://www.w3.org/1999/xhtml">opgprof</b>)</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
If you're familiar with the output produced by <b xmlns="http://www.w3.org/1999/xhtml">GNU gprof</b>,
you may find <b xmlns="http://www.w3.org/1999/xhtml">opgprof</b> useful. It takes a single binary
as an argument, and produces a <tt xmlns="http://www.w3.org/1999/xhtml">gmon.out</tt> file for use
with <b xmlns="http://www.w3.org/1999/xhtml">gprof -p</b>. If call-graph profiling is enabled,
then this is also included.
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opgprof `which oprofiled` # generates gmon.out file
$ gprof -p `which oprofiled` | head
Flat profile:

Each sample counts as 1 samples.
  %   cumulative   self              self     total
 time   samples   samples    calls  T1/call  T1/call  name
 33.13 206237.00 206237.00                             odb_insert
 22.67 347386.00 141149.00                             pop_buffer_value
  9.56 406881.00 59495.00                             opd_put_sample
  7.34 452599.00 45718.00                             opd_find_image
  7.19 497327.00 44728.00                             opd_process_samples
</pre>
              </td>
            </tr>
          </table>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opgprof-details"/>4.1. Usage of <b xmlns="http://www.w3.org/1999/xhtml">opgprof</b></h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--help / -? / --usage</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show help message.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--image-path / -p [paths]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of additional paths to search for binaries.
This is needed to find modules in kernels 2.6 and upwards.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--output-filename / -o [file]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output to the given file instead of the default, gmon.out
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--threshold / -t [percentage]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Only output data for symbols that have more than the given percentage
of total samples.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--verbose / -V [options]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Give verbose debugging output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--version / -v</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show version.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="oparchive"/>5. Archiving measurements (<b xmlns="http://www.w3.org/1999/xhtml">oparchive</b>)</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
	The <b xmlns="http://www.w3.org/1999/xhtml">oparchive</b> utility generates a directory populated
	with executable, debug, and oprofile sample files. This directory can be
	moved to another machine via <b xmlns="http://www.w3.org/1999/xhtml">tar</b> and analyzed without
	further use of the data collection machine.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
	The following command would collect the sample files, the executables
	associated with the sample files, and the debuginfo files associated
	with the executables and copy them into
	<tt xmlns="http://www.w3.org/1999/xhtml">/tmp/current_data</tt>:
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
# oparchive -o /tmp/current_data
</pre>
              </td>
            </tr>
          </table>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="oparchive-details"/>5.1. Usage of <b xmlns="http://www.w3.org/1999/xhtml">oparchive</b></h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--help / -? / --usage</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show help message.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--exclude-dependent / -x</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Do not include application-specific images for libraries, kernel modules
and the kernel. This option only makes sense if the profile session
used --separate.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--image-path / -p [paths]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Comma-separated list of additional paths to search for binaries.
This is needed to find modules in kernels 2.6 and upwards.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--output-directory / -o [directory]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Output to the given directory. There is no default. This must be specified.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--verbose / -V [options]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Give verbose debugging output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--version / -v</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show version.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="opimport"/>6. Converting sample database files (<b xmlns="http://www.w3.org/1999/xhtml">opimport</b>)</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
	This utility converts sample database files from a foreign binary format (abi) to
	the native format. This is useful only when moving sample files between hosts,
	for analysis on platforms other than the one used for collection. The abi format
	of the file to be imported is described in a text file located in <tt xmlns="http://www.w3.org/1999/xhtml">/var/lib/oprofile/abi</tt>.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
	The following command would convert the input samples files to the
	output samples files using the given abi file as a binary description
	of the input file and the curent platform abi as a binary description
	of the output file.
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
# opimport -a /var/lib/oprofile/abi -o /tmp/current/.../GLOBAL_POWER_EVENTS.200000.1.all.all.all /var/lib/.../mprime/GLOBAL_POWER_EVENTS.200000.1.all.all.all
</pre>
              </td>
            </tr>
          </table>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="opimport-details"/>6.1. Usage of <b xmlns="http://www.w3.org/1999/xhtml">opimport</b></h3>
              </div>
            </div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="variablelist">
              <dl>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--help / -? / --usage</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show help message.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--abi / -a [filename]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Input abi file description location.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--force / -f</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Force conversion even if the input and output abi are identical.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--output / -o [filename]</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Specify the output filename. If the output file already exists, the file is
not overwritten but data are accumulated in. Sample filename are informative
for post profile tools and must be kept identical, in other word the pathname
from the first path component containing a '{' must be kept as it in the
output filename.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--verbose / -V</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Give verbose debugging output.
</p>
                </dd>
                <dt xmlns="http://www.w3.org/1999/xhtml">
                  <span xmlns="http://www.w3.org/1999/xhtml" class="term">
                    <tt xmlns="http://www.w3.org/1999/xhtml">--version / -v</tt>
                  </span>
                </dt>
                <dd xmlns="http://www.w3.org/1999/xhtml">
                  <p xmlns="http://www.w3.org/1999/xhtml">
Show version.
</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="interpreting"/>Chapter 5. Interpreting profiling results</h2>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="toc">
          <p xmlns="http://www.w3.org/1999/xhtml">
            <b>Table of Contents</b>
          </p>
          <dl>
            <dt>1. <a xmlns="http://www.w3.org/1999/xhtml" href="#irq-latency">Profiling interrupt latency</a></dt>
            <dt>2. <a xmlns="http://www.w3.org/1999/xhtml" href="#kernel-profiling">Kernel profiling</a></dt>
            <dd>
              <dl>
                <dt>2.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#irq-masking">Interrupt masking</a></dt>
                <dt>2.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#idle">Idle time</a></dt>
                <dt>2.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#kernel-modules">Profiling kernel modules</a></dt>
              </dl>
            </dd>
            <dt>3. <a xmlns="http://www.w3.org/1999/xhtml" href="#interpreting-callgraph">Interpreting call-graph profiles</a></dt>
            <dt>4. <a xmlns="http://www.w3.org/1999/xhtml" href="#debug-info">Inaccuracies in annotated source</a></dt>
            <dd>
              <dl>
                <dt>4.1. <a xmlns="http://www.w3.org/1999/xhtml" href="#effect-of-optimizations">Side effects of optimizations</a></dt>
                <dt>4.2. <a xmlns="http://www.w3.org/1999/xhtml" href="#prologues">Prologues and epilogues</a></dt>
                <dt>4.3. <a xmlns="http://www.w3.org/1999/xhtml" href="#inlined-function">Inlined functions</a></dt>
                <dt>4.4. <a xmlns="http://www.w3.org/1999/xhtml" href="#wrong-linenr-info">Inaccuracy in line number information</a></dt>
              </dl>
            </dd>
            <dt>5. <a xmlns="http://www.w3.org/1999/xhtml" href="#symbol-without-debug-info">Assembly functions</a></dt>
            <dt>6. <a xmlns="http://www.w3.org/1999/xhtml" href="#hidden-cost">Other discrepancies</a></dt>
          </dl>
        </div>
        <p xmlns="http://www.w3.org/1999/xhtml">
The standard caveats of profiling apply in interpreting the results from OProfile:
profile realistic situations, profile different scenarios, profile
for as long as a time as possible, avoid system-specific artifacts, don't trust
the profile data too much. Also bear in mind the comments on the performance
counters above - you <span xmlns="http://www.w3.org/1999/xhtml" class="emphasis"><i xmlns="http://www.w3.org/1999/xhtml">cannot</i></span> rely on totally accurate
instruction-level profiling.  However, for almost all circumstances the data
can be useful. Ideally a utility such as Intel's VTUNE would be available to
allow careful instruction-level analysis; go hassle Intel for this, not me ;)
</p>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="irq-latency"/>1. Profiling interrupt latency</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
This is an example of how the latency of delivery of profiling interrupts
can impact the reliability of the profiling data. This is pretty much a 
worst-case-scenario example: these problems are fairly rare.
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
double fun(double a, double b, double c)
{
 double result = 0;
 for (int i = 0 ; i &lt; 10000; ++i) {
  result += a;
  result *= b;
  result /= c;
 }
 return result;
}
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Here the last instruction of the loop is very costly, and you would expect the result
reflecting that - but (cutting the instructions inside the loop):
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opannotate -a -t 10 ./a.out

     88 15.38% : 8048337:       fadd   %st(3),%st
     48 8.391% : 8048339:       fmul   %st(2),%st
     68 11.88% : 804833b:       fdiv   %st(1),%st
    368 64.33% : 804833d:       inc    %eax
               : 804833e:       cmp    $0x270f,%eax
               : 8048343:       jle    8048337
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
The problem comes from the x86 hardware; when the counter overflows the IRQ
is asserted but the hardware has features that can delay the NMI interrupt:
x86 hardware is synchronous (i.e. cannot interrupt during an instruction);
there is also a latency when the IRQ is asserted, and the multiple
execution units and the out-of-order model of modern x86 CPUs also causes
problems. This is the same function, with annotation :
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
$ opannotate -s -t 10 ./a.out

               :double fun(double a, double b, double c)
               :{ /* _Z3funddd total:     572 100.0% */
               : double result = 0;
    368 64.33% : for (int i = 0 ; i &lt; 10000; ++i) {
     88 15.38% :  result += a;
     48 8.391% :  result *= b;
     68 11.88% :  result /= c;
               : }
               : return result;
               :}
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
The conclusion: don't trust samples coming at the end of a loop,
particularly if the last instruction generated by the compiler is costly. This
case can also occur for branches. Always bear in mind that samples
can be delayed by a few cycles from its real position. That's a hardware
problem and OProfile can do nothing about it.
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="kernel-profiling"/>2. Kernel profiling</h2>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="irq-masking"/>2.1. Interrupt masking</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
OProfile uses non-maskable interrupts (NMI) on the P6 generation, Pentium 4,
Athlon and Duron processors. These interrupts can occur even in section of the
Linux where interrupts are disabled, allowing collection of samples in virtually
all executable code.  The RTC, timer interrupt mode, and Itanium 2 collection mechanisms
use maskable interrupts. Thus, the RTC and Itanium 2 data collection mechanism have &quot;sample
shadows&quot;, or blind spots: regions where no samples will be collected. Typically, the samples
will be attributed to the code immediately after the interrupts are re-enabled.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="idle"/>2.2. Idle time</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Your kernel is likely to support halting the processor when a CPU is idle. As
the typical hardware events like <tt xmlns="http://www.w3.org/1999/xhtml">CPU_CLK_UNHALTED</tt> do not
count when the CPU is halted, the kernel profile will not reflect the actual
amount of time spent idle. You can change this behaviour by booting with
the <tt xmlns="http://www.w3.org/1999/xhtml">idle=poll</tt> option, which uses a different idle routine. This
will appear as <tt xmlns="http://www.w3.org/1999/xhtml">poll_idle()</tt> in your kernel profile.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="kernel-modules"/>2.3. Profiling kernel modules</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
OProfile profiles kernel modules by default. However, there are a couple of problems
you may have when trying to get results. First, you may have booted via an initrd;
this means that the actual path for the module binaries cannot be determined automatically.
To get around this, you can use the <tt xmlns="http://www.w3.org/1999/xhtml">-p</tt> option to the profiling tools
to specify where to look for the kernel modules.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
In 2.6, the information on where kernel module binaries are located has been removed.
This means OProfile needs guiding with the <tt xmlns="http://www.w3.org/1999/xhtml">-p</tt> option to find your
modules. Normally, you can just use your standard module top-level directory for this.
Note that due to this problem, OProfile cannot check that the modification times match;
it is your responsibility to make sure you do not modify a binary after a profile
has been created.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
If you have run <b xmlns="http://www.w3.org/1999/xhtml">insmod</b> or <b xmlns="http://www.w3.org/1999/xhtml">modprobe</b> to insert a module
in a particular directory, it is important that you specify this directory with the 
<tt xmlns="http://www.w3.org/1999/xhtml">-p</tt> option first, so that it over-rides an older module binary that might
exist in other directories you've specified with <tt xmlns="http://www.w3.org/1999/xhtml">-p</tt>. It is up to you
to make sure that these values are correct: 2.6 kernels simply do not provide enough
information for OProfile to get this information.
</p>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="interpreting-callgraph"/>3. Interpreting call-graph profiles</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
Sometimes the results from call-graph profiles may be different to what
you expect to see. The first thing to check is whether the target
binaries where compiled with frame pointers enabled (if the binary was
compiled using <b xmlns="http://www.w3.org/1999/xhtml">gcc</b>'s
<tt xmlns="http://www.w3.org/1999/xhtml">-fomit-frame-pointer</tt> option, you will not get
meaningful results). Note that as of this writing, the GCC developers
plan to disable frame pointers by default. The Linux kernel is built
without frame pointers by default; there is a configuration option you
can use to turn it on under the &quot;Kernel Hacking&quot; menu.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Often you may see a caller of a function that does not actually directly
call the function you're looking at (e.g. if <tt xmlns="http://www.w3.org/1999/xhtml">a()</tt>
calls <tt xmlns="http://www.w3.org/1999/xhtml">b()</tt>, which in turn calls
<tt xmlns="http://www.w3.org/1999/xhtml">c()</tt>, you may see an entry for
<tt xmlns="http://www.w3.org/1999/xhtml">a()-&gt;c()</tt>).  What's actually occurring is that we
are taking samples at the very start (or the very end) of
<tt xmlns="http://www.w3.org/1999/xhtml">c()</tt>; at these few instructions, we haven't yet
created the new function's frame, so it appears as if
<tt xmlns="http://www.w3.org/1999/xhtml">a()</tt> is calling directly into
<tt xmlns="http://www.w3.org/1999/xhtml">c()</tt>. Be careful not to be misled by these
entries.
</p>
          <p xmlns="http://www.w3.org/1999/xhtml">
Like the rest of OProfile, call-graph profiling uses a statistical
approach; this means that sometimes a backtrace sample is truncated, or
even partially wrong. Bear this in mind when examining results.
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="debug-info"/>4. Inaccuracies in annotated source</h2>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="effect-of-optimizations"/>4.1. Side effects of optimizations</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The compiler can introduce some pitfalls in the annotated source output.
The optimizer can move pieces of code in such manner that two line of codes
are interlaced (instruction scheduling). Also debug info generated by the compiler 
can show strange behavior. This is especially true for complex expressions e.g. inside
an if statement:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
	if (a &amp;&amp; ..
	    b &amp;&amp; ..
	    c &amp;&amp;)
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
here the problem come from the position of line number. The available debug
info does not give enough details for the if condition, so all samples are
accumulated at the position of the right brace of the expression. Using
<b xmlns="http://www.w3.org/1999/xhtml">opannotate <tt xmlns="http://www.w3.org/1999/xhtml">-a</tt></b> can help to show the real
samples at an assembly level.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="prologues"/>4.2. Prologues and epilogues</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
The compiler generally needs to generate &quot;glue&quot; code across function calls, dependent
on the particular function call conventions used. Additionally other things
need to happen, like stack pointer adjustment for the local variables; this
code is known as the function prologue. Similar code is needed at function return,
and is known as the function epilogue. This will show up in annotations as
samples at the very start and end of a function, where there is no apparent
executable code in the source.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="inlined-function"/>4.3. Inlined functions</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
You may see that a function is credited with a certain number of samples, but
the listing does not add up to the correct total. To pick a real example :
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
               :internal_sk_buff_alloc_security(struct sk_buff *skb)
 353 2.342%    :{ /* internal_sk_buff_alloc_security total: 1882 12.48% */
               :
               :        sk_buff_security_t *sksec;
  15 0.0995%   :        int rc = 0;
               :
  10 0.06633%  :        sksec = skb-&gt;lsm_security;
 468 3.104%    :        if (sksec &amp;&amp; sksec-&gt;magic == DSI_MAGIC) {
               :                goto out;
               :        }
               :
               :        sksec = (sk_buff_security_t *) get_sk_buff_memory(skb);
   3 0.0199%   :        if (!sksec) {
  38 0.2521%   :                rc = -ENOMEM;
               :                goto out;
  10 0.06633%  :        }
               :        memset(sksec, 0, sizeof (sk_buff_security_t));
  44 0.2919%   :        sksec-&gt;magic = DSI_MAGIC;
  32 0.2123%   :        sksec-&gt;skb = skb;
  45 0.2985%   :        sksec-&gt;sid = DSI_SID_NORMAL;
  31 0.2056%   :        skb-&gt;lsm_security = sksec;
               :
               :      out:
               :
 146 0.9685%   :        return rc;
               :
  98 0.6501%   :}
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Here, the function is credited with 1,882 samples, but the annotations
below do not account for this. This is usually because of inline functions -
the compiler marks such code with debug entries for the inline function
definition, and this is where <b xmlns="http://www.w3.org/1999/xhtml">opannotate</b> annotates
such samples. In the case above, <tt xmlns="http://www.w3.org/1999/xhtml">memset</tt> is the most
likely candidate for this problem. Examining the mixed source/assembly
output can help identify such results.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
This problem is more visible when there is no source file available, in the
following example it's trivially visible the sums of symbols samples is less
than the number of the samples for this file. The difference must be accounted
to inline functions.
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
/*
 * Total samples for file : &quot;arch/i386/kernel/process.c&quot;
 *
 *    109  2.4616
 */

 /* default_idle total:     84  1.8970 */
 /* cpu_idle total:         21  0.4743 */
 /* flush_thread total:      1  0.0226 */
 /* prepare_to_copy total:   1  0.0226 */
 /* __switch_to total:      18  0.4065 */
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
The missing samples are not lost, they will be credited to another source
location where the inlined function is defined. The inlined function will be
credited from multiple call site and merged in one place in the annotated
source file so there is no way to see from what call site are coming the
samples for an inlined function.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
When running <b xmlns="http://www.w3.org/1999/xhtml">opannotate</b>, you may get a warning
&quot;some functions compiled without debug information may have incorrect source line attributions&quot;.
In some rare cases, OProfile is not able to verify that the derived source line
is correct (when some parts of the binary image are compiled without debugging
information). Be wary of results if this warning appears.
</p>
            <p xmlns="http://www.w3.org/1999/xhtml">
Furthermore, for some languages the compiler can implicitly generate functions,
such as default copy constructors. Such functions are labelled by the compiler
as having a line number of 0, which means the source annotation can be confusing.
</p>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="sect2">
            <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
              <div xmlns="http://www.w3.org/1999/xhtml">
                <h3 class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="wrong-linenr-info"/>4.4. Inaccuracy in line number information</h3>
              </div>
            </div>
            <p xmlns="http://www.w3.org/1999/xhtml">
Depending on your compiler you can fall into the following problem:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
struct big_object { int a[500]; };

int main()
{
	big_object a, b;
	for (int i = 0 ; i != 1000 * 1000; ++i)
		b = a;
	return 0;
}

</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
Compiled with <b xmlns="http://www.w3.org/1999/xhtml">gcc</b> 3.0.4 the annotated source is clearly inaccurate:
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
               :int main()
               :{  /* main total: 7871 100% */
               :        big_object a, b;
               :        for (int i = 0 ; i != 1000 * 1000; ++i)
               :                b = a;
 7871 100%     :        return 0;
               :}
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
The problem here is distinct from the IRQ latency problem; the debug line number
information is not precise enough; again, looking at output of <b xmlns="http://www.w3.org/1999/xhtml">opannoatate -as</b> can help.
</p>
            <table border="0" style="background: #E0E0E0;" width="90%">
              <tr>
                <td>
                  <pre class="screen">
               :int main()
               :{
               :        big_object a, b;
               :        for (int i = 0 ; i != 1000 * 1000; ++i)
               : 80484c0:       push   %ebp
               : 80484c1:       mov    %esp,%ebp
               : 80484c3:       sub    $0xfac,%esp
               : 80484c9:       push   %edi
               : 80484ca:       push   %esi
               : 80484cb:       push   %ebx
               :                b = a;
               : 80484cc:       lea    0xfffff060(%ebp),%edx
               : 80484d2:       lea    0xfffff830(%ebp),%eax
               : 80484d8:       mov    $0xf423f,%ebx
               : 80484dd:       lea    0x0(%esi),%esi
               :        return 0;
    3 0.03811% : 80484e0:       mov    %edx,%edi
               : 80484e2:       mov    %eax,%esi
    1 0.0127%  : 80484e4:       cld
    8 0.1016%  : 80484e5:       mov    $0x1f4,%ecx
 7850 99.73%   : 80484ea:       repz movsl %ds:(%esi),%es:(%edi)
    9 0.1143%  : 80484ec:       dec    %ebx
               : 80484ed:       jns    80484e0
               : 80484ef:       xor    %eax,%eax
               : 80484f1:       pop    %ebx
               : 80484f2:       pop    %esi
               : 80484f3:       pop    %edi
               : 80484f4:       leave
               : 80484f5:       ret
</pre>
                </td>
              </tr>
            </table>
            <p xmlns="http://www.w3.org/1999/xhtml">
So here it's clear that copying is correctly credited with of all the samples, but the
line number information is misplaced. <b xmlns="http://www.w3.org/1999/xhtml">objdump -dS</b> exposes the
same problem. Note that maintaining accurate debug information for compilers when optimizing is difficult, so this problem is not suprising.
The problem of debug information
accuracy is also dependent on the binutils version used; some BFD library versions
contain a work-around for known problems of <b xmlns="http://www.w3.org/1999/xhtml">gcc</b>, some others do not. This is unfortunate but we must live with that,
since profiling is pointless when you disable optimisation (which would give better debugging entries).
</p>
          </div>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="symbol-without-debug-info"/>5. Assembly functions</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
Often the assembler cannot generate debug information automatically.
This means that you cannot get a source report unless 
you manually define the neccessary debug information; read your assembler documentation for how you might
do that. The only
debugging info needed currently by OProfile is the line-number/filename-VMA association. When profiling assembly
without debugging info you can always get report for symbols, and optionally for VMA, through <b xmlns="http://www.w3.org/1999/xhtml">opreport -l</b>
or <b xmlns="http://www.w3.org/1999/xhtml">opreport -d</b>, but this works only for symbols with the right attributes.
For <b xmlns="http://www.w3.org/1999/xhtml">gas</b> you can get this by
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
.globl foo
	.type	foo,@function
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml"> 
whilst for <b xmlns="http://www.w3.org/1999/xhtml">nasm</b> you must use
</p>
          <table border="0" style="background: #E0E0E0;" width="90%">
            <tr>
              <td>
                <pre class="screen">
	  GLOBAL foo:function		; [1]
</pre>
              </td>
            </tr>
          </table>
          <p xmlns="http://www.w3.org/1999/xhtml">
Note that OProfile does not need the global attribute, only the function attribute.
</p>
        </div>
        <div xmlns="http://www.w3.org/1999/xhtml" class="sect1">
          <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
            <div xmlns="http://www.w3.org/1999/xhtml">
              <h2 class="title" style="clear: both"><a xmlns="http://www.w3.org/1999/xhtml" id="hidden-cost"/>6. Other discrepancies</h2>
            </div>
          </div>
          <p xmlns="http://www.w3.org/1999/xhtml">
Another cause of apparent problems is the hidden cost of instructions. A very
common example is two memory reads: one from L1 cache and the other from memory:
the second memory read is likely to have more samples.
There are many other causes of hidden cost of instructions. A non-exhaustive
list: mis-predicted branch, TLB cache miss, partial register stall,
partial register dependencies, memory mismatch stall, re-executed µops. If you want to write
programs at the assembly level, be sure to take a look at the Intel and
AMD documentation at <a xmlns="http://www.w3.org/1999/xhtml" href="http://developer.intel.com/">http://developer.intel.com/</a>
and <a xmlns="http://www.w3.org/1999/xhtml" href="http://www.amd.com/products/cpg/athlon/techdocs/">http://www.amd.com/products/cpg/athlon/techdocs/</a>.
</p>
        </div>
      </div>
      <div xmlns="http://www.w3.org/1999/xhtml" class="chapter">
        <div xmlns="http://www.w3.org/1999/xhtml" class="titlepage">
          <div xmlns="http://www.w3.org/1999/xhtml">
            <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="ack"/>Chapter 6. Acknowledgments</h2>
          </div>
        </div>
        <p xmlns="http://www.w3.org/1999/xhtml">
Thanks to (in no particular order) : Arjan van de Ven, Rik van Riel, Juan Quintela, Philippe Elie,
Phillipp Rumpf, Tigran Aivazian, Alex Brown, Alisdair Rawsthorne, Bob Montgomery, Ray Bryant, H.J. Lu,
Jeff Esper, Will Cohen, Graydon Hoare, Cliff Woolley, Alex Tsariounov, Al Stone, Jason Yeh,
Randolph Chung, Anton Blanchard, Richard Henderson, Andries Brouwer, Bryan Rittmeyer,
Maynard P. Johnson,
Richard Reich (rreich@rdrtech.com), Zwane Mwaikambo, Dave Jones, Charles Filtness; and finally Pulp, for &quot;Intro&quot;.
</p>
      </div>
    </div>
  </body>
</html>
